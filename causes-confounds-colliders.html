<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Week 3: Causes, Confounds &amp; Colliders | Statistical Rethinking: Solutions (2nd Edition)</title>
<meta name="author" content="Jake Thompson">
<meta name="description" content="The third week covers Chapter 5 (The Many Variables &amp; The Spurious Waffles) and Chapter 6 (The Haunted DAG &amp; The Causal Terror).  3.1 Lectures Lecture 5:  Lecture 6:   3.2 Exercises  3.2.1 Chapter...">
<meta name="generator" content="bookdown 0.24 with bs4_book()">
<meta property="og:title" content="Week 3: Causes, Confounds &amp; Colliders | Statistical Rethinking: Solutions (2nd Edition)">
<meta property="og:type" content="book">
<meta property="og:url" content="https://sr2-solutions.wjakethompson.com/causes-confounds-colliders.html">
<meta property="og:description" content="The third week covers Chapter 5 (The Many Variables &amp; The Spurious Waffles) and Chapter 6 (The Haunted DAG &amp; The Causal Terror).  3.1 Lectures Lecture 5:  Lecture 6:   3.2 Exercises  3.2.1 Chapter...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Week 3: Causes, Confounds &amp; Colliders | Statistical Rethinking: Solutions (2nd Edition)">
<meta name="twitter:site" content="@wjakethompson">
<meta name="twitter:description" content="The third week covers Chapter 5 (The Many Variables &amp; The Spurious Waffles) and Chapter 6 (The Haunted DAG &amp; The Causal Terror).  3.1 Lectures Lecture 5:  Lecture 6:   3.2 Exercises  3.2.1 Chapter...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.11/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><link href="libs/_Source%20Sans%20Pro-0.4.0/font.css" rel="stylesheet">
<link href="libs/_Fira%20Code-0.4.0/font.css" rel="stylesheet">
<link href="libs/_Oxygen-0.4.0/font.css" rel="stylesheet">
<script src="libs/bs3compat-0.3.1/transition.js"></script><script src="libs/bs3compat-0.3.1/tabs.js"></script><script src="libs/bs3compat-0.3.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="assets/style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Statistical Rethinking: Solutions (2nd Edition)</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Welcome</a></li>
<li><a class="" href="bayesian-inference.html"><span class="header-section-number">1</span> Bayesian Inference</a></li>
<li><a class="" href="linear-models-causal-inference.html"><span class="header-section-number">2</span> Linear Models &amp; Causal Inference</a></li>
<li><a class="active" href="causes-confounds-colliders.html"><span class="header-section-number">3</span> Causes, Confounds &amp; Colliders</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/wjakethompson/sr2-solutions">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="causes-confounds-colliders" class="section level1" number="3">
<h1>
<span class="header-section-number">Week 3:</span> Causes, Confounds &amp; Colliders<a class="anchor" aria-label="anchor" href="#causes-confounds-colliders"><i class="fas fa-link"></i></a>
</h1>
<p>The third week covers <a href="https://bookdown.org/content/4857/the-many-variables-the-spurious-waffles.html">Chapter 5 (The Many Variables &amp; The Spurious Waffles)</a> and <a href="https://bookdown.org/content/4857/the-haunted-dag-the-causal-terror.html">Chapter 6 (The Haunted DAG &amp; The Causal Terror)</a>.</p>
<div id="lectures-2" class="section level2" number="3.1">
<h2>
<span class="header-section-number">3.1</span> Lectures<a class="anchor" aria-label="anchor" href="#lectures-2"><i class="fas fa-link"></i></a>
</h2>
<p>Lecture 5:</p>
<iframe src="https://www.youtube.com/embed/UpP-_mBvECI" width="100%" height="400px" data-external="1">
</iframe>
<p>Lecture 6:</p>
<iframe src="https://www.youtube.com/embed/NSuTaeW6Orc" width="100%" height="400px" data-external="1">
</iframe>
</div>
<div id="exercises-2" class="section level2" number="3.2">
<h2>
<span class="header-section-number">3.2</span> Exercises<a class="anchor" aria-label="anchor" href="#exercises-2"><i class="fas fa-link"></i></a>
</h2>
<div id="chapter-5" class="section level3" number="3.2.1">
<h3>
<span class="header-section-number">3.2.1</span> Chapter 5<a class="anchor" aria-label="anchor" href="#chapter-5"><i class="fas fa-link"></i></a>
</h3>
<div class="question">
<blockquote>
<p><strong>5E1.</strong> Which of the linear models below are multiple linear regressions?
<span class="math display">\[\begin{align}
(1)\ \ \mu_i &amp;= \alpha + \beta x_i \\
(2)\ \ \mu_i &amp;= \beta_x x_i + \beta_z z_i \\
(3)\ \ \mu_i &amp;= \alpha + \beta(x_i - z_i) \\
(4)\ \ \mu_i &amp;= \alpha + \beta_x x_i + \beta_z z_i
\end{align}\]</span></p>
</blockquote>
</div>
<p>Numbers 2 and 4 are multiple regressions. Number 1 contains only one predictor variable. Number 3, although two variables appear in the model, also only uses the difference of <span class="math inline">\(x\)</span> and <span class="math inline">\(z\)</span> as a single predictor. Only numbers 2 and 4 contain multiple predictor variables.</p>
<div class="question">
<blockquote>
<p><strong>5E2.</strong> Write down a multiple regression to evaluate the claim: <em>Animal diversity is linearly related to latitude, but only after controlling for plant diversity</em>. You just need to write down the model definition.</p>
</blockquote>
</div>
<p>We will denote animal diversity as <span class="math inline">\(A\)</span>, latitude as <span class="math inline">\(L\)</span>, and plant diversity as <span class="math inline">\(P\)</span>. The linear model can then be defined as follows:</p>
<p><span class="math display">\[\begin{align}
  A_i &amp;\sim \text{Normal}(\mu, \sigma) \\
  \mu_i &amp;= \alpha + \beta_L L_i + \beta_P P_i
\end{align}\]</span></p>
<div class="question">
<blockquote>
<p><strong>5E3.</strong> Write down a multiple regression to evaluate the claim: <em>Neither amount of funding nor size of laboratory is by itself a good predictor of time to PhD degree; but together these variables are both positively associated with time to degree</em>. Write down the model definition and indicate which side of zero each slope parameter should be on.</p>
</blockquote>
</div>
<p>We will denote time to PhD degree as <span class="math inline">\(T\)</span>, amount of funding as <span class="math inline">\(F\)</span>, and size of laboratory as <span class="math inline">\(L\)</span>. The model is then defined as:</p>
<p><span class="math display">\[\begin{align}
  T_i &amp;\sim \text{Normal}(\mu_i, \sigma) \\
  \mu_i &amp;= \alpha + \beta_F F_i + \beta_L L_i
\end{align}\]</span></p>
<p>Both <span class="math inline">\(\beta_F\)</span> and <span class="math inline">\(\beta_L\)</span> should be positive. In order for both funding and lab size to show a positive relationship together but no relationship separately, these two variables would need to be negatively correlated (i.e., large labs have less funding per student and small labs have more funding per student). Both could be positively associated with our outcome, but be negatively associated in the real world. Thus, analyzing the variables in isolation may mask the positive relationship.</p>
<div class="question">
<blockquote>
<p><strong>5E4.</strong> Suppose you have a single categorical predictor with 4 levels (unique values), labeled A, B, C and D. Let <span class="math inline">\(A_i\)</span> be an indicator variable that is 1 where case <span class="math inline">\(i\)</span> is in category <span class="math inline">\(A\)</span>. Also suppose <span class="math inline">\(B_i\)</span>, <span class="math inline">\(C_i\)</span>, and <span class="math inline">\(D_i\)</span> for the other categories. Now which of the following linear models are inferentially equivalent ways to include the categorical variable in a regression? Model are inferentially equivalent when it’s possible to compute one posterior distribution from the posterior distribution of another model.
<span class="math display">\[\begin{align}
(1)\ \ \mu_i &amp;= \alpha + \beta_A A_i + \beta_B B_i + \beta_D D_i \\
(2)\ \ \mu_i &amp;= \alpha + \beta_A A_i + \beta_B B_i + \beta_C C_i + \beta_D D_i \\
(3)\ \ \mu_i &amp;= \alpha + \beta_B B_i + \beta_C C_i + \beta_D D_i \\
(4)\ \ \mu_i &amp;= \alpha_A A_i + \alpha_B B_i + \alpha_C C_i + \alpha_D D_i \\
(5)\ \ \mu_i &amp;= \alpha_A (1 - B_i - C_i - D_i) + \alpha_B B_i + \alpha_C C_i + \alpha_D D_i
\end{align}\]</span></p>
</blockquote>
</div>
<p>Numbers 1, 3, 4, and 5 are all inferentially equivalent. Numbers 1 and 3 both use 3 of the 4 indicator variables, meaning that you can always calculate the 4th from the three that are estimated and the intercept. Number 4 is equivalent to an index variable approach, which is inferentially equivalent to the indicator variable approach. Finally, Number 5 is mathematically equivalent to Number 4, assuming that each observation can belong to only 1 of the 4 groups.</p>
<p>Number 2 is not a valid model representation, as the model should only contain <span class="math inline">\(k-1\)</span> indicator variables with an intercept (when using an indicator variable approach). Because all 4 are included in the definition of Number 2, we should expect to have estimation problems (if the model will estimate at all).</p>
<div class="question">
<blockquote>
<p><strong>5M1.</strong> Invent your own example of a spurious correlation. An outcome variable should be correlated with both predictor variables. But when both predictors are entered in the same model, the correlation between the outcome and one of the predictors should mostly vanish (or at least be greatly reduced).</p>
</blockquote>
</div>
<p>In this (simulated) example, we’ll predict ice cream sales from the temperature and the number of shark attacks. First, we’ll fit two bivariate regressions, <code>mod_t</code> and <code>mod_s</code>, which include only temperature and shark attacks as predictors, respectively. Then we’ll estimate multivariate regression, <code>mod_all</code>, which includes both predictors.</p>
<div class="sourceCode" id="cb88"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">2022</span><span class="op">)</span>
<span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">100</span>
<span class="va">temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>
<span class="va">shark</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n</span>, <span class="va">temp</span><span class="op">)</span>
<span class="va">ice_cream</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n</span>, <span class="va">temp</span><span class="op">)</span>

<span class="va">spur_exp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span><span class="va">ice_cream</span>, <span class="va">temp</span>, <span class="va">shark</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">standardize</span><span class="op">)</span><span class="op">)</span>

<span class="va">mod_t</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/brms/man/brm.html">brm</a></span><span class="op">(</span><span class="va">ice_cream</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">temp</span>, data <span class="op">=</span> <span class="va">spur_exp</span>, family <span class="op">=</span> <span class="va">gaussian</span>,
             prior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu">normal</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.2</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">Intercept</span><span class="op">)</span>,
                       <span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu">normal</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.5</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">b</span><span class="op">)</span>,
                       <span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/brms/man/brmsfamily.html">exponential</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">sigma</span><span class="op">)</span><span class="op">)</span>,
             iter <span class="op">=</span> <span class="fl">4000</span>, warmup <span class="op">=</span> <span class="fl">2000</span>, chains <span class="op">=</span> <span class="fl">4</span>, cores <span class="op">=</span> <span class="fl">4</span>, seed <span class="op">=</span> <span class="fl">1234</span>,
             file <span class="op">=</span> <span class="fu">here</span><span class="op">(</span><span class="st">"fits"</span>, <span class="st">"chp5"</span>, <span class="st">"b5m1-t"</span><span class="op">)</span><span class="op">)</span>

<span class="va">mod_s</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/brms/man/brm.html">brm</a></span><span class="op">(</span><span class="va">ice_cream</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">shark</span>, data <span class="op">=</span> <span class="va">spur_exp</span>, family <span class="op">=</span> <span class="va">gaussian</span>,
             prior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu">normal</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.2</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">Intercept</span><span class="op">)</span>,
                       <span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu">normal</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.5</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">b</span><span class="op">)</span>,
                       <span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/brms/man/brmsfamily.html">exponential</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">sigma</span><span class="op">)</span><span class="op">)</span>,
             iter <span class="op">=</span> <span class="fl">4000</span>, warmup <span class="op">=</span> <span class="fl">2000</span>, chains <span class="op">=</span> <span class="fl">4</span>, cores <span class="op">=</span> <span class="fl">4</span>, seed <span class="op">=</span> <span class="fl">1234</span>,
             file <span class="op">=</span> <span class="fu">here</span><span class="op">(</span><span class="st">"fits"</span>, <span class="st">"chp5"</span>, <span class="st">"b5m1-s"</span><span class="op">)</span><span class="op">)</span>

<span class="va">mod_all</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/brms/man/brm.html">brm</a></span><span class="op">(</span><span class="va">ice_cream</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">temp</span> <span class="op">+</span> <span class="va">shark</span>, data <span class="op">=</span> <span class="va">spur_exp</span>, family <span class="op">=</span> <span class="va">gaussian</span>,
               prior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu">normal</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.2</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">Intercept</span><span class="op">)</span>,
                         <span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu">normal</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.5</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">b</span><span class="op">)</span>,
                         <span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/brms/man/brmsfamily.html">exponential</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">sigma</span><span class="op">)</span><span class="op">)</span>,
               iter <span class="op">=</span> <span class="fl">4000</span>, warmup <span class="op">=</span> <span class="fl">2000</span>, chains <span class="op">=</span> <span class="fl">4</span>, cores <span class="op">=</span> <span class="fl">4</span>, seed <span class="op">=</span> <span class="fl">1234</span>,
               file <span class="op">=</span> <span class="fu">here</span><span class="op">(</span><span class="st">"fits"</span>, <span class="st">"chp5"</span>, <span class="st">"b5m1-all"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>The plot below shows the posterior distributions of the <span class="math inline">\(\beta\)</span> coefficients for temperature and shark attacks. As expected, both have a positive relationship with ice cream sales in the bivariate models. However, when both predictors are included in <code>mod_all</code>, the posterior distribution for <code>b_shark</code> moves down to zero, whereas the distribution of <code>b_temp</code> remains basically the same. Thus, the relationship between ice cream sales and shark attacks is a spurious correlation, as both are informed by the temperature.</p>
<div class="sourceCode" id="cb89"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span><span class="op">(</span>
  <span class="fu"><a href="http://mjskay.github.io/tidybayes/reference/spread_draws.html">spread_draws</a></span><span class="op">(</span><span class="va">mod_t</span>, <span class="va">b_temp</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>model <span class="op">=</span> <span class="st">"mod_t"</span><span class="op">)</span>,
  <span class="fu"><a href="http://mjskay.github.io/tidybayes/reference/spread_draws.html">spread_draws</a></span><span class="op">(</span><span class="va">mod_s</span>, <span class="va">b_shark</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>model <span class="op">=</span> <span class="st">"mod_s"</span><span class="op">)</span>,
  <span class="fu"><a href="http://mjskay.github.io/tidybayes/reference/spread_draws.html">spread_draws</a></span><span class="op">(</span><span class="va">mod_all</span>, <span class="va">b_temp</span>, <span class="va">b_shark</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>model <span class="op">=</span> <span class="st">"mod_all"</span><span class="op">)</span>
<span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"b_"</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"parameter"</span>,
               values_to <span class="op">=</span> <span class="st">"value"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">model</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"mod_t"</span>, <span class="st">"mod_s"</span>, <span class="st">"mod_all"</span><span class="op">)</span><span class="op">)</span>,
         parameter <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">parameter</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"b_temp"</span>, <span class="st">"b_shark"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">value</span>, y <span class="op">=</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_rev.html">fct_rev</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">parameter</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="http://mjskay.github.io/ggdist/reference/stat_sample_slabinterval.html">stat_halfeye</a></span><span class="op">(</span>.width <span class="op">=</span> <span class="fl">0.89</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Parameter Value"</span>, y <span class="op">=</span> <span class="st">"Model"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="03-causes-confounds-colliders_files/figure-html/e5m1-2-1.png" width="80%" style="display: block; margin: auto;"></div>
<div class="question">
<blockquote>
<p><strong>5M2.</strong> Invent your own example of a masked relationship. An outcome variable should be correlated with both predictor variables, but in opposite directions. And the two predictor variables should be correlated with one another.</p>
</blockquote>
</div>
<p>For this (also simulated) example, we’ll predict an academic test score from the amount of instruction a student received and the number of days they missed class. First, we’ll fit two bivariate regressions, <code>mod_i</code> and <code>mod_d</code>, which include only instruction and days away as predictors, respectively. Then we’ll estimate multivariate regression, <code>mod_test</code>, which includes both predictors.</p>
<div class="sourceCode" id="cb90"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">2020</span><span class="op">)</span>
<span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">100</span>
<span class="va">u</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>
<span class="va">days_away</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n</span>, <span class="va">u</span><span class="op">)</span>
<span class="va">instruction</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n</span>, <span class="va">u</span><span class="op">)</span>
<span class="va">test_score</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n</span>, <span class="va">instruction</span> <span class="op">-</span> <span class="va">days_away</span><span class="op">)</span>

<span class="va">mask_exp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span><span class="va">test_score</span>, <span class="va">instruction</span>, <span class="va">days_away</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">standardize</span><span class="op">)</span><span class="op">)</span>

<span class="va">mod_i</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/brms/man/brm.html">brm</a></span><span class="op">(</span><span class="va">test_score</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">instruction</span>, data <span class="op">=</span> <span class="va">mask_exp</span>, family <span class="op">=</span> <span class="va">gaussian</span>,
             prior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu">normal</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.2</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">Intercept</span><span class="op">)</span>,
                       <span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu">normal</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.5</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">b</span><span class="op">)</span>,
                       <span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/brms/man/brmsfamily.html">exponential</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">sigma</span><span class="op">)</span><span class="op">)</span>,
             iter <span class="op">=</span> <span class="fl">4000</span>, warmup <span class="op">=</span> <span class="fl">2000</span>, chains <span class="op">=</span> <span class="fl">4</span>, cores <span class="op">=</span> <span class="fl">4</span>, seed <span class="op">=</span> <span class="fl">1234</span>,
             file <span class="op">=</span> <span class="fu">here</span><span class="op">(</span><span class="st">"fits"</span>, <span class="st">"chp5"</span>, <span class="st">"b5m2-i"</span><span class="op">)</span><span class="op">)</span>

<span class="va">mod_d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/brms/man/brm.html">brm</a></span><span class="op">(</span><span class="va">test_score</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">days_away</span>, data <span class="op">=</span> <span class="va">mask_exp</span>, family <span class="op">=</span> <span class="va">gaussian</span>,
             prior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu">normal</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.2</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">Intercept</span><span class="op">)</span>,
                       <span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu">normal</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.5</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">b</span><span class="op">)</span>,
                       <span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/brms/man/brmsfamily.html">exponential</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">sigma</span><span class="op">)</span><span class="op">)</span>,
             iter <span class="op">=</span> <span class="fl">4000</span>, warmup <span class="op">=</span> <span class="fl">2000</span>, chains <span class="op">=</span> <span class="fl">4</span>, cores <span class="op">=</span> <span class="fl">4</span>, seed <span class="op">=</span> <span class="fl">1234</span>,
             file <span class="op">=</span> <span class="fu">here</span><span class="op">(</span><span class="st">"fits"</span>, <span class="st">"chp5"</span>, <span class="st">"b5m2-d"</span><span class="op">)</span><span class="op">)</span>

<span class="va">mod_test</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/brms/man/brm.html">brm</a></span><span class="op">(</span><span class="va">test_score</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">instruction</span> <span class="op">+</span> <span class="va">days_away</span>, data <span class="op">=</span> <span class="va">mask_exp</span>,
                family <span class="op">=</span> <span class="va">gaussian</span>,
                prior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu">normal</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.2</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">Intercept</span><span class="op">)</span>,
                          <span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu">normal</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.5</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">b</span><span class="op">)</span>,
                          <span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/brms/man/brmsfamily.html">exponential</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">sigma</span><span class="op">)</span><span class="op">)</span>,
                iter <span class="op">=</span> <span class="fl">4000</span>, warmup <span class="op">=</span> <span class="fl">2000</span>, chains <span class="op">=</span> <span class="fl">4</span>, cores <span class="op">=</span> <span class="fl">4</span>, seed <span class="op">=</span> <span class="fl">1234</span>,
                file <span class="op">=</span> <span class="fu">here</span><span class="op">(</span><span class="st">"fits"</span>, <span class="st">"chp5"</span>, <span class="st">"b5m2-test"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>The figure below shows the posterior distributions of the <span class="math inline">\(\beta\)</span> parameters from each of the models. We can see that in full model, <code>mod_test</code>, <code>b_instruction</code> gets more positive and <code>b_days_away</code> gets more negative.</p>
<div class="sourceCode" id="cb91"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span><span class="op">(</span>
  <span class="fu"><a href="http://mjskay.github.io/tidybayes/reference/spread_draws.html">spread_draws</a></span><span class="op">(</span><span class="va">mod_i</span>, <span class="va">b_instruction</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>model <span class="op">=</span> <span class="st">"mod_i"</span><span class="op">)</span>,
  <span class="fu"><a href="http://mjskay.github.io/tidybayes/reference/spread_draws.html">spread_draws</a></span><span class="op">(</span><span class="va">mod_d</span>, <span class="va">b_days_away</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>model <span class="op">=</span> <span class="st">"mod_d"</span><span class="op">)</span>,
  <span class="fu"><a href="http://mjskay.github.io/tidybayes/reference/spread_draws.html">spread_draws</a></span><span class="op">(</span><span class="va">mod_test</span>, <span class="va">b_instruction</span>, <span class="va">b_days_away</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>model <span class="op">=</span> <span class="st">"mod_test"</span><span class="op">)</span>
<span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"b_"</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"parameter"</span>,
               values_to <span class="op">=</span> <span class="st">"value"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">model</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"mod_i"</span>, <span class="st">"mod_d"</span>, <span class="st">"mod_test"</span><span class="op">)</span><span class="op">)</span>,
         parameter <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">parameter</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"b_instruction"</span>,
                                                  <span class="st">"b_days_away"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">value</span>, y <span class="op">=</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_rev.html">fct_rev</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">parameter</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="http://mjskay.github.io/ggdist/reference/stat_sample_slabinterval.html">stat_halfeye</a></span><span class="op">(</span>.width <span class="op">=</span> <span class="fl">0.89</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Parameter Value"</span>, y <span class="op">=</span> <span class="st">"Model"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="03-causes-confounds-colliders_files/figure-html/e5m2-2-1.png" width="80%" style="display: block; margin: auto;"></div>
<div class="question">
<blockquote>
<p><strong>5M3.</strong> It is sometimes observed that the best predictor of fire risk is the presence of firefighters—State and localities with many firefighters also have more fires. Presumably firefighters do not <em>cause</em> fires. Nevertheless, this is not a spurious correlation. Instead fires cause firefighters. Consider the same reversal of causal inference in the context of the divorce and marriage data. How might a high divorce rate cause a higher marriage rate? Can you think of a way to evaluate this relationship, using multiple regression?</p>
</blockquote>
</div>
<p>A high divorce rate means that there are more people available in the population of single-people that are available to marry. Additionally, people may be getting divorced for the specific purpose of marrying someone else. To evaluate this, we could add marriage number, or a “re-marry” indicator. We would then expect the coefficient for marriage rate to get closer to zero once this predictor is added to the model.</p>
<div class="question">
<blockquote>
<p><strong>5M4.</strong> In the divorce data, States with high numbers of members of the Church of Jesus Christ of Latter-day Saints (LDS) have much lower divorce rates than the regression models expected. Find a list of LDS population by State and use those numbers as a predictor variable, predicting divorce rate using marriage rate, median age at marriage, and percent LDS population (possibly standardized). You may want to consider transformations of the raw percent LDS variable.</p>
</blockquote>
</div>
<p>We can pull the LDS membership from the official <a href="https://newsroom.churchofjesuschrist.org/facts-and-statistics/state/alabama">LDS website</a>, and state populations from the United States census website. Conveniently, this is all pulled together on <a href="https://web.archive.org/web/20220104045513/https://worldpopulationreview.com/state-rankings/mormon-population-by-state">World Population Review</a> (copied on January 4, 2022). The data is saved in <a href="https://github.com/wjakethompson/sr2-solutions/blob/main/data/lds-data-2021.csv"><code>data/lds-data-2021.csv</code></a>. We can then combine this with our existing divorce data from <code>data("WaffleDivorce")</code>. For this analysis, I’ll use LDS membership per capita. Specifically, the number of LDS members per 100,000 in the state’s population. This will then be standardized, along with the other predictor variables, as was done in the chapter examples.</p>
<div class="sourceCode" id="cb92"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="fu">here</span><span class="op">(</span><span class="st">"data"</span>, <span class="st">"lds-data-2021.csv"</span><span class="op">)</span>,
                col_types <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/cols.html">cols</a></span><span class="op">(</span>.default <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/parse_atomic.html">col_integer</a></span><span class="op">(</span><span class="op">)</span>,
                                 state <span class="op">=</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/parse_atomic.html">col_character</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>lds_prop <span class="op">=</span> <span class="va">members</span> <span class="op">/</span> <span class="va">population</span>,
         lds_per_capita <span class="op">=</span> <span class="va">lds_prop</span> <span class="op">*</span> <span class="fl">100000</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"WaffleDivorce"</span><span class="op">)</span>
<span class="va">lds_divorce</span> <span class="op">&lt;-</span> <span class="va">WaffleDivorce</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Location</span>, <span class="va">Divorce</span>, <span class="va">Marriage</span>, <span class="va">MedianAgeMarriage</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">lds</span>, <span class="va">state</span>, <span class="va">lds_per_capita</span><span class="op">)</span>,
            by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Location"</span> <span class="op">=</span> <span class="st">"state"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>lds_per_capita <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">lds_per_capita</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu">where</span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span>, <span class="va">standardize</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">lds_per_capita</span><span class="op">)</span><span class="op">)</span>

<span class="va">lds_divorce</span>
<span class="co">#&gt; # A tibble: 49 × 5</span>
<span class="co">#&gt;    Location    Divorce Marriage MedianAgeMarriage lds_per_capita</span>
<span class="co">#&gt;    &lt;chr&gt;         &lt;dbl&gt;    &lt;dbl&gt;             &lt;dbl&gt;          &lt;dbl&gt;</span>
<span class="co">#&gt;  1 Alabama       1.65    0.0226            -0.606         -0.423</span>
<span class="co">#&gt;  2 Alaska        1.54    1.55              -0.687          1.21 </span>
<span class="co">#&gt;  3 Arizona       0.611   0.0490            -0.204          1.42 </span>
<span class="co">#&gt;  4 Arkansas      2.09    1.66              -1.41          -0.123</span>
<span class="co">#&gt;  5 California   -0.927  -0.267              0.600          0.409</span>
<span class="co">#&gt;  6 Colorado      1.05    0.892             -0.285          0.671</span>
<span class="co">#&gt;  7 Connecticut  -1.64   -0.794              1.24          -0.909</span>
<span class="co">#&gt;  8 Delaware     -0.433   0.786              0.439         -0.693</span>
<span class="co">#&gt;  9 Florida      -0.652  -0.820              0.278         -0.466</span>
<span class="co">#&gt; 10 Georgia       0.995   0.523             -0.124         -0.375</span>
<span class="co">#&gt; # … with 39 more rows</span></code></pre></div>
<p>We’re now ready to estimate our model.</p>
<div class="sourceCode" id="cb93"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lds_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/brms/man/brm.html">brm</a></span><span class="op">(</span><span class="va">Divorce</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">Marriage</span> <span class="op">+</span> <span class="va">MedianAgeMarriage</span> <span class="op">+</span> <span class="va">lds_per_capita</span>,
               data <span class="op">=</span> <span class="va">lds_divorce</span>, family <span class="op">=</span> <span class="va">gaussian</span>,
               prior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu">normal</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.2</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">Intercept</span><span class="op">)</span>,
                         <span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu">normal</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.5</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">b</span>, coef <span class="op">=</span> <span class="va">Marriage</span><span class="op">)</span>,
                         <span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu">normal</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.5</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">b</span>, coef <span class="op">=</span> <span class="va">MedianAgeMarriage</span><span class="op">)</span>,
                         <span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu">normal</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.5</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">b</span>, coef <span class="op">=</span> <span class="va">lds_per_capita</span><span class="op">)</span>,
                         <span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/brms/man/brmsfamily.html">exponential</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">sigma</span><span class="op">)</span><span class="op">)</span>,
               iter <span class="op">=</span> <span class="fl">4000</span>, warmup <span class="op">=</span> <span class="fl">2000</span>, chains <span class="op">=</span> <span class="fl">4</span>, cores <span class="op">=</span> <span class="fl">4</span>, seed <span class="op">=</span> <span class="fl">1234</span>,
               file <span class="op">=</span> <span class="fu">here</span><span class="op">(</span><span class="st">"fits"</span>, <span class="st">"chp5"</span>, <span class="st">"b5m4"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Finally, we can visualize our estimates. The intercept and coefficients for <code>Marriage</code> and <code>MedianAgeMarriage</code> are nearly identical to those from model <code>m5.3</code> in the text. Thus, it appears that our new predictor, LDS per capita, is contributing unique information. As expected, a higher population of LDS members in a state is associated with a lower divorce rate.</p>
<div class="sourceCode" id="cb94"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="http://mjskay.github.io/tidybayes/reference/spread_draws.html">spread_draws</a></span><span class="op">(</span><span class="va">lds_mod</span>, <span class="va">`b_.*`</span>, regex <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"b_"</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"parameter"</span>,
               values_to <span class="op">=</span> <span class="st">"value"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">value</span>, y <span class="op">=</span> <span class="va">parameter</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="http://mjskay.github.io/ggdist/reference/stat_sample_slabinterval.html">stat_halfeye</a></span><span class="op">(</span>.width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.67</span>, <span class="fl">0.89</span>, <span class="fl">0.97</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Parameter Value"</span>, y <span class="op">=</span> <span class="st">"Parameter"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="03-causes-confounds-colliders_files/figure-html/e5m4-3-1.png" width="80%" style="display: block; margin: auto;"></div>
<div class="question">
<blockquote>
<p><strong>5M5.</strong> One way to reason through multiple causation hypotheses is to imagine detailed mechanisms through which predictor variables may influence outcomes. For example, it is sometimes argued that the price of gasoline (predictor variable) is positively associated with lower obesity rates (outcome variable). However, there are at least two important mechanisms by which the price of gas could reduce obesity. First, it could lead to less driving and therefore more exercise. Second, it could lead to less driving, which leads to less eating out, which leds to less consumption of huge restaurant meals. Can you outline one or more multiple regressions that address these two mechanisms? Assume you can have any predictor data you need.</p>
</blockquote>
</div>
<p>Let’s assume we have four variables: rate of obesity (<span class="math inline">\(O\)</span>), price of gasoline (<span class="math inline">\(G\)</span>), amount of driving (<span class="math inline">\(D\)</span>), amount of exercise (<span class="math inline">\(E\)</span>), and the rate of eating out at restaurants (<span class="math inline">\(R\)</span>). Given these variables, we can outline the first proposed mechanism implies:</p>
<ol style="list-style-type: decimal">
<li>
<span class="math inline">\(D\)</span> is negatively associated with <span class="math inline">\(P\)</span>
</li>
<li>
<span class="math inline">\(E\)</span> is negatively associated with <span class="math inline">\(D\)</span>
</li>
<li>
<span class="math inline">\(O\)</span> is negatively associated with <span class="math inline">\(E\)</span>
</li>
</ol>
<p>This is a chain of causality, where each outcome is the input of the next chain. The second mechanism is similar:</p>
<ol style="list-style-type: decimal">
<li>
<span class="math inline">\(D\)</span> is negatively associated with <span class="math inline">\(P\)</span>
</li>
<li>
<span class="math inline">\(R\)</span> is positively associated with <span class="math inline">\(D\)</span>
</li>
<li>
<span class="math inline">\(O\)</span> is positively associated with <span class="math inline">\(R\)</span>
</li>
</ol>
<div class="question">
<blockquote>
<p><strong>5H1.</strong> In the divorce example, suppose the DAG is: <span class="math inline">\(M \rightarrow A \rightarrow D\)</span>. What are the implied conditional independencies of the graph? Are the data consistent with it?</p>
</blockquote>
</div>
<p>We can use {dagitty} <span class="citation">(<a href="references.html#ref-R-dagitty" role="doc-biblioref">Textor et al., 2021</a>)</span> to see the implied conditional independencies. From this code we see that the DAG implies that divorce rate is independent of marriage rate conditional on median age of marriage.</p>
<div class="sourceCode" id="cb95"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://www.dagitty.net">dagitty</a></span><span class="op">)</span>

<span class="va">mad_dag</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/dagitty/man/dagitty.html">dagitty</a></span><span class="op">(</span><span class="st">"dag{M -&gt; A -&gt; D}"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/dagitty/man/impliedConditionalIndependencies.html">impliedConditionalIndependencies</a></span><span class="op">(</span><span class="va">mad_dag</span><span class="op">)</span>
<span class="co">#&gt; D _||_ M | A</span></code></pre></div>
<p>As shown in model <code>m5.3</code>, the data is consistent with this implied conditional independency. Thus this data is consistent with multiple DAGs. Specifically, it would support all Markov Equivalent DAGs. The second DAG in this list, <code>D &lt;- A -&gt; M</code>, is the DAG that was investigated in the text.</p>
<div class="sourceCode" id="cb96"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/dagitty/man/EquivalentModels.html">equivalentDAGs</a></span><span class="op">(</span><span class="va">mad_dag</span><span class="op">)</span>
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt; dag {</span>
<span class="co">#&gt; A</span>
<span class="co">#&gt; D</span>
<span class="co">#&gt; M</span>
<span class="co">#&gt; A -&gt; D</span>
<span class="co">#&gt; M -&gt; A</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[2]]</span>
<span class="co">#&gt; dag {</span>
<span class="co">#&gt; A</span>
<span class="co">#&gt; D</span>
<span class="co">#&gt; M</span>
<span class="co">#&gt; A -&gt; D</span>
<span class="co">#&gt; A -&gt; M</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[3]]</span>
<span class="co">#&gt; dag {</span>
<span class="co">#&gt; A</span>
<span class="co">#&gt; D</span>
<span class="co">#&gt; M</span>
<span class="co">#&gt; A -&gt; M</span>
<span class="co">#&gt; D -&gt; A</span>
<span class="co">#&gt; }</span></code></pre></div>
<div class="question">
<blockquote>
<p><strong>5H2.</strong> Assuming that the DAG for the divorce example is indeed <span class="math inline">\(M \rightarrow A \rightarrow D\)</span>, fit a new model and use it to estimate the counterfactual effect of halving a State’s marriage rate <span class="math inline">\(M\)</span>. Using the counterfactual example from the chapter (starting on page 140) as a template.</p>
</blockquote>
</div>
<p>First, we’ll estimate a model consistent this this DAG. Because there are two regressions here, we’ll use {brms}’s multivariate syntax (i.e., <code><a href="https://rdrr.io/pkg/brms/man/brmsformula.html">bf()</a></code>; see <a href="https://paul-buerkner.github.io/brms/articles/brms_multivariate.html">here</a>).</p>
<div class="sourceCode" id="cb97"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dat</span> <span class="op">&lt;-</span> <span class="va">WaffleDivorce</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span>A <span class="op">=</span> <span class="va">MedianAgeMarriage</span>,
         D <span class="op">=</span> <span class="va">Divorce</span>,
         M <span class="op">=</span> <span class="va">Marriage</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">standardize</span><span class="op">)</span><span class="op">)</span>

<span class="va">d_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/brms/man/brmsformula.html">bf</a></span><span class="op">(</span><span class="va">D</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">A</span><span class="op">)</span>
<span class="va">a_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/brms/man/brmsformula.html">bf</a></span><span class="op">(</span><span class="va">A</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">M</span><span class="op">)</span>

<span class="va">b5h2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/brms/man/brm.html">brm</a></span><span class="op">(</span><span class="va">d_model</span> <span class="op">+</span> <span class="va">a_model</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/brms/man/brmsformula-helpers.html">set_rescor</a></span><span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span>,
            data <span class="op">=</span> <span class="va">dat</span>, family <span class="op">=</span> <span class="va">gaussian</span>,
            prior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu">normal</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.2</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">Intercept</span>, resp <span class="op">=</span> <span class="va">D</span><span class="op">)</span>,
                      <span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu">normal</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.5</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">b</span>, resp <span class="op">=</span> <span class="va">D</span><span class="op">)</span>,
                      <span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/brms/man/brmsfamily.html">exponential</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">sigma</span>, resp <span class="op">=</span> <span class="va">D</span><span class="op">)</span>,
                      
                      <span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu">normal</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.2</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">Intercept</span>, resp <span class="op">=</span> <span class="va">A</span><span class="op">)</span>,
                      <span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu">normal</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.5</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">b</span>, resp <span class="op">=</span> <span class="va">A</span><span class="op">)</span>,
                      <span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/brms/man/brmsfamily.html">exponential</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">sigma</span>, resp <span class="op">=</span> <span class="va">A</span><span class="op">)</span><span class="op">)</span>,
            iter <span class="op">=</span> <span class="fl">4000</span>, warmup <span class="op">=</span> <span class="fl">2000</span>, chains <span class="op">=</span> <span class="fl">4</span>, cores <span class="op">=</span> <span class="fl">4</span>, seed <span class="op">=</span> <span class="fl">1234</span>,
            file <span class="op">=</span> <span class="fu">here</span><span class="op">(</span><span class="st">"fits"</span>, <span class="st">"chp5"</span>, <span class="st">"b5h2"</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://mc-stan.org/cmdstanr/reference/fit-method-summary.html">summary</a></span><span class="op">(</span><span class="va">b5h2</span><span class="op">)</span>
<span class="co">#&gt;  Family: MV(gaussian, gaussian) </span>
<span class="co">#&gt;   Links: mu = identity; sigma = identity</span>
<span class="co">#&gt;          mu = identity; sigma = identity </span>
<span class="co">#&gt; Formula: D ~ 1 + A </span>
<span class="co">#&gt;          A ~ 1 + M </span>
<span class="co">#&gt;    Data: dat (Number of observations: 50) </span>
<span class="co">#&gt;   Draws: 4 chains, each with iter = 2000; warmup = 0; thin = 1;</span>
<span class="co">#&gt;          total post-warmup draws = 8000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Population-Level Effects: </span>
<span class="co">#&gt;             Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS</span>
<span class="co">#&gt; D_Intercept     0.00      0.10    -0.20     0.20 1.00    10726     6132</span>
<span class="co">#&gt; A_Intercept    -0.00      0.09    -0.17     0.18 1.00    10190     6073</span>
<span class="co">#&gt; D_A            -0.56      0.11    -0.78    -0.34 1.00     9422     6605</span>
<span class="co">#&gt; A_M            -0.69      0.10    -0.89    -0.49 1.00     8993     5538</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Family Specific Parameters: </span>
<span class="co">#&gt;         Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS</span>
<span class="co">#&gt; sigma_D     0.82      0.09     0.67     1.01 1.00    10660     5820</span>
<span class="co">#&gt; sigma_A     0.71      0.07     0.58     0.88 1.00    10351     6034</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Draws were sampled using sample(hmc). For each parameter, Bulk_ESS</span>
<span class="co">#&gt; and Tail_ESS are effective sample size measures, and Rhat is the potential</span>
<span class="co">#&gt; scale reduction factor on split chains (at convergence, Rhat = 1).</span></code></pre></div>
<p>We can then simulate our counterfactuals and plot with {ggplot2}. We see that there is a negative relationship between marriage rate and age. That is, as marriage rate increases, the age at marriage decreases on average. Specifically, <span class="math inline">\(A\)</span> moves about -0.7 units for every 1 unit increase in <span class="math inline">\(M\)</span>, which is reflected in the estimate of <code>A_M</code> in the model summary above. For the counterfactual of <span class="math inline">\(M\)</span> on <span class="math inline">\(D\)</span>, we see a positive relationship. This is because both the relationship of <span class="math inline">\(M\)</span> to <span class="math inline">\(A\)</span> and <span class="math inline">\(A\)</span> to <span class="math inline">\(D\)</span> are negative. In other words, as <span class="math inline">\(M\)</span> increases <span class="math inline">\(A\)</span> decreases, and as <span class="math inline">\(A\)</span> decreases <span class="math inline">\(D\)</span> increases. For every one unit increase in <span class="math inline">\(M\)</span>, we expect about a 0.4 unit increase in <span class="math inline">\(D\)</span>. This can also be derived by multiplying the slope coefficients from the model summary (i.e., −0.56 × −0.69 ≈ 0.4).</p>
<div class="sourceCode" id="cb98"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/brms/man/draws-brms.html">as_draws_df</a></span><span class="op">(</span><span class="va">b5h2</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">.draw</span>, <span class="va">b_D_Intercept</span><span class="op">:</span><span class="va">sigma_A</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/expand.html">expand</a></span><span class="op">(</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/expand.html">nesting</a></span><span class="op">(</span><span class="va">.draw</span>, <span class="va">b_D_Intercept</span>, <span class="va">b_A_Intercept</span>, <span class="va">b_D_A</span>, <span class="va">b_A_M</span>,
                 <span class="va">sigma_D</span>, <span class="va">sigma_A</span><span class="op">)</span>,
         m <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="op">-</span><span class="fl">2</span>, to <span class="op">=</span> <span class="fl">2</span>, length.out <span class="op">=</span> <span class="fl">30</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>a_sim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>, mean <span class="op">=</span> <span class="va">b_A_Intercept</span> <span class="op">+</span> <span class="va">b_A_M</span> <span class="op">*</span> <span class="va">m</span>, sd <span class="op">=</span> <span class="va">sigma_A</span><span class="op">)</span>,
         d_sim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>, mean <span class="op">=</span> <span class="va">b_D_Intercept</span> <span class="op">+</span> <span class="va">b_D_A</span> <span class="op">*</span> <span class="va">a_sim</span>, sd <span class="op">=</span> <span class="va">sigma_D</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">ends_with</a></span><span class="op">(</span><span class="st">"_sim"</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"name"</span>, values_to <span class="op">=</span> <span class="st">"value"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">m</span>, <span class="va">name</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="http://mjskay.github.io/ggdist/reference/point_interval.html">mean_qi</a></span><span class="op">(</span><span class="va">value</span>, .width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.89</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>name <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span><span class="va">name</span> <span class="op">==</span> <span class="st">"a_sim"</span> <span class="op">~</span> <span class="st">"Counterfactual M &amp;rarr; A"</span>,
                          <span class="cn">TRUE</span> <span class="op">~</span> <span class="st">"Counterfactual M &amp;rarr; A &amp;rarr; D"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">m</span>, y <span class="op">=</span> <span class="va">value</span>, ymin <span class="op">=</span> <span class="va">.lower</span>, ymax <span class="op">=</span> <span class="va">.upper</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">name</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Manipulated M"</span>, y <span class="op">=</span> <span class="st">"Counterfactual"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="03-causes-confounds-colliders_files/figure-html/e5h2-2-1.png" width="80%" style="display: block; margin: auto;"></div>
<p>The question specifically asks for the counterfactual effect of halving a state’s marriage rate. This is dependent on what the original marriage rate was. For this problem, we’ll use the average marriage rate across all states, which is about 20. Half of that is 10, which in our standardized units that were used to fit the model is -2.66. Looking at the counterfactual plot, moving from an <span class="math inline">\(M\)</span> of 0 to an <span class="math inline">\(M\)</span> of -2.66 would result in a decrease in the divorce rate of about 1 standard deviation. We can calculate this directly using code as well. Here we also see an estimated difference of -1.03 standard deviations, with an 89% posterior interval of -3.14 to 1.08.</p>
<div class="sourceCode" id="cb99"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/brms/man/draws-brms.html">as_draws_df</a></span><span class="op">(</span><span class="va">b5h2</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>a_avg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">b_A_Intercept</span> <span class="op">+</span> <span class="va">b_A_M</span> <span class="op">*</span> <span class="fl">0</span>, <span class="va">sigma_A</span><span class="op">)</span>,
         a_hlf <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">b_A_Intercept</span> <span class="op">+</span> <span class="va">b_A_M</span> <span class="op">*</span> <span class="op">-</span><span class="fl">2.66</span>, <span class="va">sigma_A</span><span class="op">)</span>,
         d_avg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">b_D_Intercept</span> <span class="op">+</span> <span class="va">b_D_A</span> <span class="op">*</span> <span class="va">a_avg</span>, <span class="va">sigma_D</span><span class="op">)</span>,
         d_hlf <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">b_D_Intercept</span> <span class="op">+</span> <span class="va">b_D_A</span> <span class="op">*</span> <span class="va">a_hlf</span>, <span class="va">sigma_D</span><span class="op">)</span>,
         diff <span class="op">=</span> <span class="va">d_hlf</span> <span class="op">-</span> <span class="va">d_avg</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="http://mjskay.github.io/ggdist/reference/point_interval.html">mean_hdi</a></span><span class="op">(</span><span class="va">diff</span>, .width <span class="op">=</span> <span class="fl">0.89</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 1 × 6</span>
<span class="co">#&gt;    diff .lower .upper .width .point .interval</span>
<span class="co">#&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    </span>
<span class="co">#&gt; 1 -1.03  -3.11   1.09   0.89 mean   hdi</span></code></pre></div>
<div class="question">
<blockquote>
<p><strong>5H3.</strong> Return to the milk energy model, <code>m5.7</code>. Suppose that the true causal relationship among the variables is:</p>
</blockquote>
<div class="table-question">
<img src="img/e5h3-dag.png" width="40%" style="display: block; margin: auto;">
</div>
<blockquote>
<p>Now compute the counterfactual effect on <span class="math inline">\(K\)</span> of doubling <span class="math inline">\(M\)</span>. You will need to account for both the direct and indirect paths of causation. Use the counterfactual example from the chapter (starting on page 140) as a template.</p>
</blockquote>
</div>
<p>First, we need to estimate our model.</p>
<div class="sourceCode" id="cb100"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">milk</span><span class="op">)</span>

<span class="va">new_milk</span> <span class="op">&lt;-</span> <span class="va">milk</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">kcal.per.g</span>,
         <span class="va">neocortex.perc</span>,
         <span class="va">mass</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>log_mass <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">mass</span><span class="op">)</span>,
         K <span class="op">=</span> <span class="fu">standardize</span><span class="op">(</span><span class="va">kcal.per.g</span><span class="op">)</span>,
         N <span class="op">=</span> <span class="fu">standardize</span><span class="op">(</span><span class="va">neocortex.perc</span><span class="op">)</span>,
         M <span class="op">=</span> <span class="fu">standardize</span><span class="op">(</span><span class="va">log_mass</span><span class="op">)</span><span class="op">)</span>

<span class="va">K_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/brms/man/brmsformula.html">bf</a></span><span class="op">(</span><span class="va">K</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">M</span> <span class="op">+</span> <span class="va">N</span><span class="op">)</span>
<span class="va">N_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/brms/man/brmsformula.html">bf</a></span><span class="op">(</span><span class="va">N</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">M</span><span class="op">)</span>

<span class="va">b5h3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/brms/man/brm.html">brm</a></span><span class="op">(</span><span class="va">K_model</span> <span class="op">+</span> <span class="va">N_model</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/brms/man/brmsformula-helpers.html">set_rescor</a></span><span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span>,
            data <span class="op">=</span> <span class="va">new_milk</span>, family <span class="op">=</span> <span class="va">gaussian</span>,
            prior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu">normal</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.2</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">Intercept</span>, resp <span class="op">=</span> <span class="va">K</span><span class="op">)</span>,
                      <span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu">normal</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.5</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">b</span>, resp <span class="op">=</span> <span class="va">K</span><span class="op">)</span>,
                      <span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/brms/man/brmsfamily.html">exponential</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">sigma</span>, resp <span class="op">=</span> <span class="va">K</span><span class="op">)</span>,
                      
                      <span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu">normal</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.2</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">Intercept</span>, resp <span class="op">=</span> <span class="va">N</span><span class="op">)</span>,
                      <span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu">normal</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.5</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">b</span>, resp <span class="op">=</span> <span class="va">N</span><span class="op">)</span>,
                      <span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/brms/man/brmsfamily.html">exponential</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">sigma</span>, resp <span class="op">=</span> <span class="va">N</span><span class="op">)</span><span class="op">)</span>,
            iter <span class="op">=</span> <span class="fl">4000</span>, warmup <span class="op">=</span> <span class="fl">2000</span>, chains <span class="op">=</span> <span class="fl">4</span>, cores <span class="op">=</span> <span class="fl">4</span>, seed <span class="op">=</span> <span class="fl">1234</span>,
            file <span class="op">=</span> <span class="fu">here</span><span class="op">(</span><span class="st">"fits"</span>, <span class="st">"chp5"</span>, <span class="st">"b5h3"</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://mc-stan.org/cmdstanr/reference/fit-method-summary.html">summary</a></span><span class="op">(</span><span class="va">b5h3</span><span class="op">)</span>
<span class="co">#&gt;  Family: MV(gaussian, gaussian) </span>
<span class="co">#&gt;   Links: mu = identity; sigma = identity</span>
<span class="co">#&gt;          mu = identity; sigma = identity </span>
<span class="co">#&gt; Formula: K ~ 1 + M + N </span>
<span class="co">#&gt;          N ~ 1 + M </span>
<span class="co">#&gt;    Data: new_milk (Number of observations: 17) </span>
<span class="co">#&gt;   Draws: 4 chains, each with iter = 2000; warmup = 0; thin = 1;</span>
<span class="co">#&gt;          total post-warmup draws = 8000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Population-Level Effects: </span>
<span class="co">#&gt;             Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS</span>
<span class="co">#&gt; K_Intercept     0.00      0.14    -0.27     0.28 1.00     8841     5684</span>
<span class="co">#&gt; N_Intercept     0.00      0.13    -0.25     0.26 1.00     9335     5242</span>
<span class="co">#&gt; K_M            -0.68      0.27    -1.17    -0.11 1.00     5097     5278</span>
<span class="co">#&gt; K_N             0.57      0.26     0.02     1.05 1.00     4924     5189</span>
<span class="co">#&gt; N_M             0.66      0.17     0.32     0.98 1.00     8326     5454</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Family Specific Parameters: </span>
<span class="co">#&gt;         Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS</span>
<span class="co">#&gt; sigma_K     0.81      0.17     0.56     1.21 1.00     6085     5711</span>
<span class="co">#&gt; sigma_N     0.72      0.14     0.50     1.05 1.00     8236     5409</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Draws were sampled using sample(hmc). For each parameter, Bulk_ESS</span>
<span class="co">#&gt; and Tail_ESS are effective sample size measures, and Rhat is the potential</span>
<span class="co">#&gt; scale reduction factor on split chains (at convergence, Rhat = 1).</span></code></pre></div>
<p>Now we can calculate the counterfactual. <span class="math inline">\(M\)</span> represents the mass, so we’ll use evenly spaced values from 0.5 to 80, which captures the range of observed mass in the data. We’ll then predict new values of <span class="math inline">\(K\)</span> from these masses.</p>
<div class="sourceCode" id="cb101"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">milk_cf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/brms/man/draws-brms.html">as_draws_df</a></span><span class="op">(</span><span class="va">b5h3</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">.draw</span>, <span class="va">b_K_Intercept</span><span class="op">:</span><span class="va">sigma_N</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/expand.html">expand</a></span><span class="op">(</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/expand.html">nesting</a></span><span class="op">(</span><span class="va">.draw</span>, <span class="va">b_K_Intercept</span>, <span class="va">b_N_Intercept</span>, <span class="va">b_K_M</span>, <span class="va">b_K_N</span>, <span class="va">b_N_M</span>,
                 <span class="va">sigma_K</span>, <span class="va">sigma_N</span><span class="op">)</span>,
         mass <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">0.5</span>, to <span class="op">=</span> <span class="fl">80</span>, by <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>log_mass <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">mass</span><span class="op">)</span>,
         M <span class="op">=</span> <span class="op">(</span><span class="va">log_mass</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">new_milk</span><span class="op">$</span><span class="va">log_mass</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">new_milk</span><span class="op">$</span><span class="va">log_mass</span><span class="op">)</span>,
         n_sim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>, mean <span class="op">=</span> <span class="va">b_N_Intercept</span> <span class="op">+</span> <span class="va">b_N_M</span> <span class="op">*</span> <span class="va">M</span>, sd <span class="op">=</span> <span class="va">sigma_N</span><span class="op">)</span>,
         k_sim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>, mean <span class="op">=</span> <span class="va">b_K_Intercept</span> <span class="op">+</span> <span class="va">b_K_N</span> <span class="op">*</span> <span class="va">n_sim</span> <span class="op">+</span> <span class="va">b_K_M</span> <span class="op">*</span> <span class="va">M</span>,
                       sd <span class="op">=</span> <span class="va">sigma_K</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">ends_with</a></span><span class="op">(</span><span class="st">"_sim"</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"name"</span>, values_to <span class="op">=</span> <span class="st">"value"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">mass</span>, <span class="va">name</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="http://mjskay.github.io/ggdist/reference/point_interval.html">mean_qi</a></span><span class="op">(</span><span class="va">value</span>, .width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.89</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">name</span> <span class="op">==</span> <span class="st">"k_sim"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>name <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span><span class="op">(</span><span class="va">name</span> <span class="op">==</span> <span class="st">"n_sim"</span> <span class="op">~</span> <span class="st">"Counterfactual effect M on N"</span>,
                          <span class="cn">TRUE</span> <span class="op">~</span> <span class="st">"Total Counterfactual effect of M on K"</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">milk_cf</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">mass</span>, y <span class="op">=</span> <span class="va">value</span>, ymin <span class="op">=</span> <span class="va">.lower</span>, ymax <span class="op">=</span> <span class="va">.upper</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Manipulated Mass"</span>, y <span class="op">=</span> <span class="st">"Counterfactual K"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="03-causes-confounds-colliders_files/figure-html/e5h3-2-1.png" width="80%" style="display: block; margin: auto;"></div>
<p>As we can see in the plot, because mass is log-transformed in the model, there is a non-linear relationship between the manipulated mass and our counterfactual. Thus, the impact of doubling mass depends on the original mass. As in the previous example, we’ll use the average mass (≈15kg) as the baseline. Thus in the standardized log units used to estimate our model, we’re comparing an <span class="math inline">\(M\)</span> value of 0.746 to 1.154. The code below shows that doubling the mass has only a small effect on <span class="math inline">\(K\)</span> with a quick wide compatibility interval.</p>
<div class="sourceCode" id="cb102"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">15</span>, <span class="fl">30</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">milk</span><span class="op">$</span><span class="va">mass</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">milk</span><span class="op">$</span><span class="va">mass</span><span class="op">)</span><span class="op">)</span> 
<span class="co">#&gt; [1] 0.746 1.154</span>

<span class="fu"><a href="https://rdrr.io/pkg/brms/man/draws-brms.html">as_draws_df</a></span><span class="op">(</span><span class="va">b5h3</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>n_avg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">b_N_Intercept</span> <span class="op">+</span> <span class="va">b_N_M</span> <span class="op">*</span> <span class="fl">0.746</span>, <span class="va">sigma_N</span><span class="op">)</span>,
         n_dbl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">b_N_Intercept</span> <span class="op">+</span> <span class="va">b_N_M</span> <span class="op">*</span> <span class="fl">1.154</span>, <span class="va">sigma_N</span><span class="op">)</span>,
         k_avg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">b_K_Intercept</span> <span class="op">+</span> <span class="va">b_K_M</span> <span class="op">*</span> <span class="fl">0.746</span> <span class="op">+</span> <span class="va">b_K_N</span> <span class="op">*</span> <span class="va">n_avg</span>,
                       <span class="va">sigma_K</span><span class="op">)</span>,
         k_dbl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">b_K_Intercept</span> <span class="op">+</span> <span class="va">b_K_M</span> <span class="op">*</span> <span class="fl">1.154</span> <span class="op">+</span> <span class="va">b_K_N</span> <span class="op">*</span> <span class="va">n_dbl</span>,
                       <span class="va">sigma_K</span><span class="op">)</span>,
         diff <span class="op">=</span> <span class="va">k_dbl</span> <span class="op">-</span> <span class="va">k_avg</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="http://mjskay.github.io/ggdist/reference/point_interval.html">median_hdi</a></span><span class="op">(</span><span class="va">diff</span>, .width <span class="op">=</span> <span class="fl">0.89</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 1 × 6</span>
<span class="co">#&gt;     diff .lower .upper .width .point .interval</span>
<span class="co">#&gt;    &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    </span>
<span class="co">#&gt; 1 -0.151  -2.45   1.82   0.89 median hdi</span></code></pre></div>
<div class="question">
<blockquote>
<p><strong>5H4.</strong> Here is an open practice problem to engage your imagination. In the divorce data, States in the southern United States have many of the highest divorce rates. Add the <code>South</code> indicator variable to the analysis. First, draw one or more DAGs that represent your ideas for how Southern American culture might influence any of the other three variables (<span class="math inline">\(D\)</span>, <span class="math inline">\(M\)</span>, or <span class="math inline">\(A\)</span>). Then list the testable implications of your DAGs, if there are any, and fit one or more models to evaluate the implications. What do you think the influence of “Southerness” is?</p>
</blockquote>
</div>
<p>First, let’s draw a DAG using {ggdag} <span class="citation">(<a href="references.html#ref-R-ggdag" role="doc-biblioref">Barrett, 2021</a>)</span>.</p>
<div class="sourceCode" id="cb103"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dag_coords</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"S"</span>, <span class="st">"A"</span>, <span class="st">"M"</span>, <span class="st">"D"</span><span class="op">)</span>,
         x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span>,
         y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>

<span class="fu">dagify</span><span class="op">(</span><span class="va">D</span> <span class="op">~</span> <span class="va">A</span> <span class="op">+</span> <span class="va">M</span>,
       <span class="va">M</span> <span class="op">~</span> <span class="va">A</span> <span class="op">+</span> <span class="va">S</span>,
       <span class="va">A</span> <span class="op">~</span> <span class="va">S</span>,
       coords <span class="op">=</span> <span class="va">dag_coords</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, xend <span class="op">=</span> <span class="va">xend</span>, yend <span class="op">=</span> <span class="va">yend</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_dag_text</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span>, size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_dag_edges</span><span class="op">(</span>edge_color <span class="op">=</span> <span class="st">"black"</span>, edge_width <span class="op">=</span> <span class="fl">2</span>,
                 arrow_directed <span class="op">=</span> <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/arrow.html">arrow</a></span><span class="op">(</span>length <span class="op">=</span> <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">15</span>, <span class="st">"pt"</span><span class="op">)</span>,
                                              type <span class="op">=</span> <span class="st">"closed"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_void</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="03-causes-confounds-colliders_files/figure-html/e5h4-1-1.png" width="40%" style="display: block; margin: auto;"></div>
<p>In this proposed model, we are hypothesizing that southerness influences the median age at marriage and the marriage rate. We can use {dagitty} to view the testable implications:</p>
<div class="sourceCode" id="cb104"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">div_dag</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/dagitty/man/dagitty.html">dagitty</a></span><span class="op">(</span><span class="st">"dag{S -&gt; M -&gt; D; S -&gt; A -&gt; D; A -&gt; M}"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/dagitty/man/impliedConditionalIndependencies.html">impliedConditionalIndependencies</a></span><span class="op">(</span><span class="va">div_dag</span><span class="op">)</span>
<span class="co">#&gt; D _||_ S | A, M</span></code></pre></div>
<p>Given the DAG, divorce rate should be independent of southerness when we condition on median age at marriage and marriage rate. Let’s estimate a model to test this. We’ll include median age at marriage (<span class="math inline">\(A\)</span>), marriage rate (<span class="math inline">\(M\)</span>), and southerness (<span class="math inline">\(S\)</span>) in the model. Because both <span class="math inline">\(A\)</span> and <span class="math inline">\(M\)</span> are included, we would expect the coefficient for <span class="math inline">\(S\)</span> to be zero, if the implied conditional independency holds.</p>
<div class="sourceCode" id="cb105"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"WaffleDivorce"</span><span class="op">)</span>

<span class="va">south_divorce</span> <span class="op">&lt;-</span> <span class="va">WaffleDivorce</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span>D <span class="op">=</span> <span class="va">Divorce</span>,
         A <span class="op">=</span> <span class="va">MedianAgeMarriage</span>,
         M <span class="op">=</span> <span class="va">Marriage</span>,
         S <span class="op">=</span> <span class="va">South</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu">where</span><span class="op">(</span><span class="va">is.double</span><span class="op">)</span>, <span class="va">standardize</span><span class="op">)</span><span class="op">)</span>

<span class="va">b5h4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/brms/man/brm.html">brm</a></span><span class="op">(</span><span class="va">D</span> <span class="op">~</span> <span class="va">A</span> <span class="op">+</span> <span class="va">M</span> <span class="op">+</span> <span class="va">S</span>, data <span class="op">=</span> <span class="va">south_divorce</span>, family <span class="op">=</span> <span class="va">gaussian</span>,
            prior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu">normal</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.2</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">Intercept</span><span class="op">)</span>,
                      <span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu">normal</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.5</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">b</span><span class="op">)</span>,
                      <span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/brms/man/brmsfamily.html">exponential</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">sigma</span><span class="op">)</span><span class="op">)</span>,
            iter <span class="op">=</span> <span class="fl">4000</span>, warmup <span class="op">=</span> <span class="fl">2000</span>, chains <span class="op">=</span> <span class="fl">4</span>, cores <span class="op">=</span> <span class="fl">4</span>, seed <span class="op">=</span> <span class="fl">1234</span>,
            file <span class="op">=</span> <span class="fu">here</span><span class="op">(</span><span class="st">"fits"</span>, <span class="st">"chp5"</span>, <span class="st">"b5h4"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Now we can look at the posterior distribution for the <span class="math inline">\(\beta\)</span> coefficient for southerness.</p>
<div class="sourceCode" id="cb106"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="http://mjskay.github.io/tidybayes/reference/spread_draws.html">spread_draws</a></span><span class="op">(</span><span class="va">b5h4</span>, <span class="va">b_S</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">b_S</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="http://mjskay.github.io/ggdist/reference/stat_sample_slabinterval.html">stat_halfeye</a></span><span class="op">(</span>.width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.67</span>, <span class="fl">0.89</span>, <span class="fl">0.97</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">beta</span><span class="op">[</span><span class="va">S</span><span class="op">]</span><span class="op">)</span>, y <span class="op">=</span> <span class="st">"Density"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="03-causes-confounds-colliders_files/figure-html/e5h4-4-1.png" width="80%" style="display: block; margin: auto;"></div>
<p>The effect of southerness is close to zero, but slightly larger than we might have expected. Thus, we have some preliminary evidence that the DAG we have drawn may not be accurate. However, the evidence is not strong enough to refute our proposed DAG either.</p>
</div>
<div id="chapter-6" class="section level3" number="3.2.2">
<h3>
<span class="header-section-number">3.2.2</span> Chapter 6<a class="anchor" aria-label="anchor" href="#chapter-6"><i class="fas fa-link"></i></a>
</h3>
<div class="question">
<blockquote>
<p><strong>6E1.</strong> List three mechanisms by which multiple regression can produce false inferences about causal effects.</p>
</blockquote>
</div>
<p>Three mechanisms are:</p>
<ol style="list-style-type: decimal">
<li>
<em>Multicollinearity</em>. This occurs when two or more variables are strongly assocaited, conditional on the other variables in the model.</li>
<li>
<em>Post-treatment Bias</em>. This occurs when the inclusion of a variable “blocks” the effect of another.</li>
<li>
<em>Collider Bias</em>. This occurs when two variables are unrelated to each other, but are both related to a third variable. The inclusion of the third variable creates a statistical association in the model between the first two.</li>
</ol>
<div class="question">
<blockquote>
<p><strong>6E2.</strong> For one of the mechanisms in the previous problem, provide an example of your choice, perhaps from your own research.</p>
</blockquote>
</div>
<p>In educational research, we are often interested in instructional interventions. For example, we might provide teacher with professional development (<span class="math inline">\(D\)</span>). We expect the professional development to have a positive impact on the instruction (<span class="math inline">\(I\)</span>) the teacher provides, which in turn should improve student performance (<span class="math inline">\(P\)</span>). However, student performance is also influenced by the pre-existing knowledge state (<span class="math inline">\(K\)</span>) of the teacher’s students. If we are interested in estimating the effect of <span class="math inline">\(D\)</span> on <span class="math inline">\(I\)</span>, the inclusion of <span class="math inline">\(P\)</span> in the model would be an example of a post-treatment bias, where the quality of the instruction (influencing the performance, <span class="math inline">\(P\)</span>) masks the effect of the professional development as shown in the DAG.</p>
<div class="sourceCode" id="cb107"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ed_dag</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/dagitty/man/dagitty.html">dagitty</a></span><span class="op">(</span><span class="st">"dag { D -&gt; I -&gt; P &lt;- K }"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/dagitty/man/coordinates.html">coordinates</a></span><span class="op">(</span><span class="va">ed_dag</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>D <span class="op">=</span> <span class="fl">1</span>, I <span class="op">=</span> <span class="fl">1.5</span>, P <span class="op">=</span> <span class="fl">2</span>, K <span class="op">=</span> <span class="fl">2.5</span><span class="op">)</span>,
                            y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>D <span class="op">=</span> <span class="fl">3</span>, I <span class="op">=</span> <span class="fl">2</span>, P <span class="op">=</span> <span class="fl">1</span>, K <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">ed_dag</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, xend <span class="op">=</span> <span class="va">xend</span>, yend <span class="op">=</span> <span class="va">yend</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_dag_text</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span>, size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_dag_edges</span><span class="op">(</span>edge_color <span class="op">=</span> <span class="st">"black"</span>, edge_width <span class="op">=</span> <span class="fl">2</span>,
                 arrow_directed <span class="op">=</span> <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/arrow.html">arrow</a></span><span class="op">(</span>length <span class="op">=</span> <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">15</span>, <span class="st">"pt"</span><span class="op">)</span>,
                                              type <span class="op">=</span> <span class="st">"closed"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_void</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="03-causes-confounds-colliders_files/figure-html/e6e2-1.png" width="40%" style="display: block; margin: auto;"></div>
<div class="question">
<blockquote>
<p><strong>6E3.</strong> List the four elemental confounds. Can you explain the conditional dependencies of each?</p>
</blockquote>
</div>
<ol style="list-style-type: decimal">
<li>
<em>The Fork</em>. The classic “confounder” example. A variable <span class="math inline">\(Z\)</span> is a common cause to both <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>, resulting in a correlation between <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>. In other words, <span class="math inline">\(X\)</span> is independent of <span class="math inline">\(Y\)</span>, conditional on <span class="math inline">\(Z\)</span>, or, in math notation, <span class="math inline">\(X \!\perp\!\!\!\perp Y | Z\)</span>.</li>
</ol>
<div class="inline-figure"><img src="03-causes-confounds-colliders_files/figure-html/e6e3-1-1.png" width="25%" style="display: block; margin: auto;"></div>
<ol start="2" style="list-style-type: decimal">
<li>
<em>The Pipe</em>. A variable <span class="math inline">\(X\)</span> influences, another variable <span class="math inline">\(Z\)</span>, which in turn influences the outcome <span class="math inline">\(Y\)</span>. A good example is the post-treatment bias described above. The treatment (<span class="math inline">\(X\)</span>) is meant to influence some outcome (<span class="math inline">\(Y\)</span>), but does so through an intermediary (<span class="math inline">\(Z\)</span>). Including both <span class="math inline">\(X\)</span> and <span class="math inline">\(Z\)</span> can then make it appear as though <span class="math inline">\(X\)</span> has no effect on <span class="math inline">\(Y\)</span>. Thus, as in the the fork, <span class="math inline">\(X\)</span> is independent of <span class="math inline">\(Y\)</span>, conditional on <span class="math inline">\(Z\)</span>. And in math again: <span class="math inline">\(X \!\perp\!\!\!\perp Y | Z\)</span>.</li>
</ol>
<div class="inline-figure"><img src="03-causes-confounds-colliders_files/figure-html/e6e3-2-1.png" width="25%" style="display: block; margin: auto;"></div>
<ol start="3" style="list-style-type: decimal">
<li>
<em>The Collider</em>. Unlike the fork and the pipe, the collider induces a correlation between otherwise unassociated variables. Thus, <span class="math inline">\(X\)</span> is <em>not</em> independent from <span class="math inline">\(Y\)</span>, conditional on <span class="math inline">\(Z\)</span>. In math notation, this can be written as <span class="math inline">\(X \not\!\perp\!\!\!\perp Y|Z\)</span>.</li>
</ol>
<div class="inline-figure"><img src="03-causes-confounds-colliders_files/figure-html/e6e3-3-1.png" width="25%" style="display: block; margin: auto;"></div>
<ol start="4" style="list-style-type: decimal">
<li>
<em>The Descendant</em>. In this final case, the descendant, <span class="math inline">\(D\)</span>, is influenced by another variable in the DAG, in this case <span class="math inline">\(Z\)</span>. Conditioning on the descendant has the impact of partially conditioning on the parent variable. In this example, <span class="math inline">\(Z\)</span> is a collider. Thus, if we kept <span class="math inline">\(Z\)</span> out of the model, but included <span class="math inline">\(D\)</span>, we would get a partial collider bias, because <span class="math inline">\(D\)</span> contains some of the information that is in <span class="math inline">\(Z\)</span>. How much bias is introduced depends on the strength of the relationship between the the descendant and its parent.</li>
</ol>
<div class="inline-figure"><img src="03-causes-confounds-colliders_files/figure-html/e6e3-4-1.png" width="25%" style="display: block; margin: auto;"></div>
<div class="question">
<blockquote>
<p><strong>6E4.</strong> How is a biased sample like conditioning on a collider? Think of the example at the open of the chapter.</p>
</blockquote>
</div>
<p>With a collider, an association is introduced between two variables when a third is added. A biased sample is like an un-measured collider. In the example that started the chapter, there was no association between trustworthiness and and newsworthiness. However, when selection status is added to the model, there appears to be a negative association. Now imagine that you only have data for the funded proposals. Here, there is an implicit conditioning on selection status, because you only have funded proposals. This is potentially more nefarious, because the collider isn’t explicitly in your data, or has no variance (i.e., all proposals in your data have a selection score of <code>1</code>).</p>
<div class="question">
<blockquote>
<p><strong>6M1.</strong> Modify the DAG on page 186 to include the variable <span class="math inline">\(V\)</span>, an unobserved cause of <span class="math inline">\(C\)</span> and <span class="math inline">\(Y\)</span>: <span class="math inline">\(C \leftarrow V \rightarrow Y\)</span>. Reanalyze the DAG. How many paths connect <span class="math inline">\(X\)</span> to <span class="math inline">\(Y\)</span>? Which must be closed? Which variables should you condition on now?</p>
</blockquote>
</div>
<p>The new DAG looks like this:</p>
<div class="sourceCode" id="cb108"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dag_coords</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"X"</span>, <span class="st">"U"</span>, <span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>, <span class="st">"Y"</span>, <span class="st">"V"</span><span class="op">)</span>,
                     x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">3</span>, <span class="fl">3.5</span><span class="op">)</span>,
                     y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">2.5</span>, <span class="fl">1.5</span>, <span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">1.5</span><span class="op">)</span><span class="op">)</span>

<span class="fu">dagify</span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">X</span> <span class="op">+</span> <span class="va">C</span> <span class="op">+</span> <span class="va">V</span>,
       <span class="va">X</span> <span class="op">~</span> <span class="va">U</span>,
       <span class="va">U</span> <span class="op">~</span> <span class="va">A</span>,
       <span class="va">B</span> <span class="op">~</span> <span class="va">U</span> <span class="op">+</span> <span class="va">C</span>,
       <span class="va">C</span> <span class="op">~</span> <span class="va">A</span> <span class="op">+</span> <span class="va">V</span>,
       coords <span class="op">=</span> <span class="va">dag_coords</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, xend <span class="op">=</span> <span class="va">xend</span>, yend <span class="op">=</span> <span class="va">yend</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_dag_point</span><span class="op">(</span>data <span class="op">=</span> <span class="va">.</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">name</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"U"</span>, <span class="st">"V"</span><span class="op">)</span><span class="op">)</span>,
                 shape <span class="op">=</span> <span class="fl">1</span>, stroke <span class="op">=</span> <span class="fl">2</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_dag_text</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span>, size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_dag_edges</span><span class="op">(</span>edge_color <span class="op">=</span> <span class="st">"black"</span>, edge_width <span class="op">=</span> <span class="fl">2</span>,
                 arrow_directed <span class="op">=</span> <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/arrow.html">arrow</a></span><span class="op">(</span>length <span class="op">=</span> <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">15</span>, <span class="st">"pt"</span><span class="op">)</span>,
                                              type <span class="op">=</span> <span class="st">"closed"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_void</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="03-causes-confounds-colliders_files/figure-html/e6m1-1-1.png" width="40%" style="display: block; margin: auto;"></div>
<p>There are now 5 paths from <span class="math inline">\(X\)</span> to <span class="math inline">\(Y\)</span>. The three paths from the original DAG, and 2 new paths introduced by <span class="math inline">\(V\)</span>.</p>
<ol style="list-style-type: decimal">
<li><span class="math inline">\(X \rightarrow Y\)</span></li>
<li><span class="math inline">\(X \leftarrow U \rightarrow B \leftarrow C \rightarrow Y\)</span></li>
<li><span class="math inline">\(X \leftarrow U \rightarrow B \leftarrow C \leftarrow V \rightarrow Y\)</span></li>
<li><span class="math inline">\(X \leftarrow U \leftarrow A \rightarrow C \rightarrow Y\)</span></li>
<li><span class="math inline">\(X \leftarrow U \leftarrow A \rightarrow C \leftarrow V \rightarrow Y\)</span></li>
</ol>
<p>We want to keep path 1 open, because that is the causal path of interest. Paths 2 and 3 are already closed, because <span class="math inline">\(B\)</span> is a collider. Paths 4 and 5 are open because <span class="math inline">\(A\)</span> is a fork. In the original DAG, we could close either <span class="math inline">\(A\)</span> or <span class="math inline">\(C\)</span>; however, in the new DAG, <span class="math inline">\(C\)</span> is a collider. Therefore, if we conditioned on <span class="math inline">\(C\)</span>, we’d be opening up a new path through <span class="math inline">\(V\)</span>. Therefore, if we want to make inferences about the causal effect of <span class="math inline">\(X\)</span> on <span class="math inline">\(Y\)</span>, we must only condition on <span class="math inline">\(A\)</span> (assuming our DAG is correct). We can confirm using <code><a href="https://rdrr.io/pkg/dagitty/man/adjustmentSets.html">dagitty::adjustmentSets()</a></code>.</p>
<div class="sourceCode" id="cb109"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">new_dag</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/dagitty/man/dagitty.html">dagitty</a></span><span class="op">(</span><span class="st">"dag { U [unobserved]
                          V [unobserved]
                          X -&gt; Y
                          X &lt;- U &lt;- A -&gt; C -&gt; Y
                          U -&gt; B &lt;- C
                          C &lt;- V -&gt; Y }"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/dagitty/man/adjustmentSets.html">adjustmentSets</a></span><span class="op">(</span><span class="va">new_dag</span>, exposure <span class="op">=</span> <span class="st">"X"</span>, outcome <span class="op">=</span> <span class="st">"Y"</span><span class="op">)</span>
<span class="co">#&gt; { A }</span></code></pre></div>
<div class="question">
<blockquote>
<p><strong>6M2.</strong> Sometimes, in order to avoid multicollinearity, people inspect pairwise correlations among predictors before including them in a model. This is a bad procedure, because what matters is the conditional association, not the association before the variables are included in the model. To highlight this, consider the DAG <span class="math inline">\(X \rightarrow Z \rightarrow Y\)</span>. Simulate data from this DAG so that the correlation between <span class="math inline">\(X\)</span> and <span class="math inline">\(Z\)</span> is very large. Then include both in a model prediction <span class="math inline">\(Y\)</span>. Do you observe any multicollinearity? Why or why not? What is different from the legs example in the chapter?</p>
</blockquote>
</div>
<p>First, we’ll generate some data and confirm that <code>x</code> and <code>z</code> are highly correlated in our simulation.</p>
<div class="sourceCode" id="cb110"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1984</span><span class="op">)</span>

<span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">1000</span>
<span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>z <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n</span>, mean <span class="op">=</span> <span class="va">x</span>, sd <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>,
         y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n</span>, mean <span class="op">=</span> <span class="va">z</span><span class="op">)</span>,
         <span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">standardize</span><span class="op">)</span><span class="op">)</span>

<span class="va">sim_cor</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">x</span>, <span class="va">dat</span><span class="op">$</span><span class="va">z</span><span class="op">)</span>
<span class="va">sim_cor</span>
<span class="co">#&gt; [1] 0.995</span></code></pre></div>
<p>In our generated data of <code>prettyNum(nrow(dat), big.mark = ",")</code> observations, there is a correlation of <code>fmt_prop(sim_cor, 3)</code> between <code>x</code> and <code>z</code>. Now let’s estimate a model regressing <code>y</code> on both <code>x</code> and <code>z</code>.</p>
<div class="sourceCode" id="cb111"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">b6m2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/brms/man/brm.html">brm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">x</span> <span class="op">+</span> <span class="va">z</span>, data <span class="op">=</span> <span class="va">dat</span>, family <span class="op">=</span> <span class="va">gaussian</span>,
            prior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu">normal</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.2</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">Intercept</span><span class="op">)</span>,
                      <span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu">normal</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.5</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">b</span><span class="op">)</span>,
                      <span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/brms/man/brmsfamily.html">exponential</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">sigma</span><span class="op">)</span><span class="op">)</span>,
            iter <span class="op">=</span> <span class="fl">4000</span>, warmup <span class="op">=</span> <span class="fl">2000</span>, chains <span class="op">=</span> <span class="fl">4</span>, cores <span class="op">=</span> <span class="fl">4</span>, seed <span class="op">=</span> <span class="fl">1234</span>,
            file <span class="op">=</span> <span class="fu">here</span><span class="op">(</span><span class="st">"fits"</span>, <span class="st">"chp6"</span>, <span class="st">"b6m2"</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/brms/man/draws-brms.html">as_draws_df</a></span><span class="op">(</span><span class="va">b6m2</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">b_Intercept</span>, <span class="va">b_x</span>, <span class="va">b_z</span>, <span class="va">sigma</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">value</span>, y <span class="op">=</span> <span class="va">name</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="http://mjskay.github.io/ggdist/reference/stat_sample_slabinterval.html">stat_halfeye</a></span><span class="op">(</span>.width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.67</span>, <span class="fl">0.89</span>, <span class="fl">0.97</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="03-causes-confounds-colliders_files/figure-html/e6m2-2-1.png" width="80%" style="display: block; margin: auto;"></div>
<p>In the model summary, we can see that both <code>x</code> and <code>z</code> have estimates with relatively narrow posterior distributions. This is in contrast to the example of legs in the chapter, where the estimated standard deviations of the <span class="math inline">\(beta\)</span> parameters were much larger than the magnitudes of the parameters, and the posterior distributions had significant overlap. Thus, it does not appear as though we are observing multicollinearity.</p>
<p>This is due to the causal model that gave rise to this (simulated) data. In the legs example from the chapter, both legs predicted height (left DAG below). In this example, only <span class="math inline">\(Z\)</span> predicts the outcome. In DAG language, <span class="math inline">\(Z\)</span> is a pipe. Therefore, when the model is estimated, the golem is looking at what <span class="math inline">\(X\)</span> tells us, conditional on <span class="math inline">\(Z\)</span>. The answer in this case is “not much” because <span class="math inline">\(X\)</span> and <span class="math inline">\(Z\)</span> are highly correlated, which is why the posterior for <span class="math inline">\(X\)</span> is centered on zero. The leg model does not condition on either of the predictors, as both have direct paths to the outcome variable. Thus, whether or not a model has multicollinearity depends not only on the pairwise relationship, but also the causal model.</p>
<div class="figure" style="text-align: center">
<img src="03-causes-confounds-colliders_files/figure-html/e6m2-3-1.png" alt=" " width="40%"><img src="03-causes-confounds-colliders_files/figure-html/e6m2-3-2.png" alt=" " width="40%"><p class="caption">
</p>
</div>
<div class="question">
<blockquote>
<p><strong>6M3.</strong> Learning to analyze DAGs requires practice. For each of the four DAGs below, state which variables, if any, you must adjust for (condition on) to estimate the total causal influence of <span class="math inline">\(X\)</span> on <span class="math inline">\(Y\)</span>.</p>
</blockquote>
<div class="table-question">
<div class="figure" style="text-align: center">
<img src="img/e6m3-dag1.png" alt=" " width="40%"><img src="img/e6m3-dag2.png" alt=" " width="40%"><img src="img/e6m3-dag3.png" alt=" " width="40%"><img src="img/e6m3-dag4.png" alt=" " width="40%"><p class="caption">
</p>
</div>
</div>
</div>
<p><em>Upper Left</em>: There are two back-door paths from <span class="math inline">\(X\)</span> to <span class="math inline">\(Y\)</span>: <span class="math inline">\(X \leftarrow Z \rightarrow Y\)</span> and <span class="math inline">\(X \leftarrow Z \leftarrow A \rightarrow Y\)</span>. In the first path <span class="math inline">\(Z\)</span> is a fork, and in the second, <span class="math inline">\(Z\)</span> is a pipe and <span class="math inline">\(A\)</span> is a fork. Thus, in both cases, conditioning on <span class="math inline">\(Z\)</span> would close the path. We can confirm with <code><a href="https://rdrr.io/pkg/dagitty/man/adjustmentSets.html">dagitty::adjustmentSets()</a></code>.</p>
<div class="sourceCode" id="cb112"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dag1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/dagitty/man/dagitty.html">dagitty</a></span><span class="op">(</span><span class="st">"dag{ X &lt;- Z &lt;- A -&gt; Y &lt;- X; Y &lt;- Z }"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/dagitty/man/adjustmentSets.html">adjustmentSets</a></span><span class="op">(</span><span class="va">dag1</span>, exposure <span class="op">=</span> <span class="st">"X"</span>, outcome <span class="op">=</span> <span class="st">"Y"</span><span class="op">)</span>
<span class="co">#&gt; { Z }</span></code></pre></div>
<p><em>Upper Right</em>: Again, there are two paths from <span class="math inline">\(X\)</span> to <span class="math inline">\(Y\)</span>: <span class="math inline">\(X \rightarrow Z \rightarrow Y\)</span> and <span class="math inline">\(X \rightarrow Z \leftarrow A \rightarrow Y\)</span>. The first path is an indirect causal effect for <span class="math inline">\(X\)</span> on <span class="math inline">\(Y\)</span>, which should be included when estimating the total causal effect of <span class="math inline">\(X\)</span> on <span class="math inline">\(Y\)</span>. In the second path, <span class="math inline">\(Z\)</span> is a collider, so the path is already closed and therefore no action is needed. Thus, no adjustments are needed to estimate the total effect of <span class="math inline">\(X\)</span> of <span class="math inline">\(Y\)</span>.</p>
<div class="sourceCode" id="cb113"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dag2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/dagitty/man/dagitty.html">dagitty</a></span><span class="op">(</span><span class="st">"dag{ X -&gt; Z &lt;- A -&gt; Y &lt;- X; Y &lt;- Z }"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/dagitty/man/adjustmentSets.html">adjustmentSets</a></span><span class="op">(</span><span class="va">dag2</span>, exposure <span class="op">=</span> <span class="st">"X"</span>, outcome <span class="op">=</span> <span class="st">"Y"</span><span class="op">)</span>
<span class="co">#&gt;  {}</span></code></pre></div>
<p><em>Lower Left</em>: There are two paths from <span class="math inline">\(X\)</span> to <span class="math inline">\(Y\)</span>: <span class="math inline">\(X \leftarrow A \rightarrow Z \leftarrow Y\)</span> and <span class="math inline">\(X \rightarrow Z \leftarrow Y\)</span>. There is only one causal path from <span class="math inline">\(X\)</span> to <span class="math inline">\(Y\)</span>, the direct path. In both back-door paths, <span class="math inline">\(Z\)</span> is a collider so the paths are closed unless we include it, so no additional variables need to be added to the model.</p>
<div class="sourceCode" id="cb114"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dag3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/dagitty/man/dagitty.html">dagitty</a></span><span class="op">(</span><span class="st">"dag{ Y -&gt; Z &lt;- A -&gt; X -&gt; Y; X -&gt; Z }"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/dagitty/man/adjustmentSets.html">adjustmentSets</a></span><span class="op">(</span><span class="va">dag3</span>, exposure <span class="op">=</span> <span class="st">"X"</span>, outcome <span class="op">=</span> <span class="st">"Y"</span><span class="op">)</span>
<span class="co">#&gt;  {}</span></code></pre></div>
<p><em>Lower Right</em>: Finally, this DAG also has two causal paths from <span class="math inline">\(X\)</span> to <span class="math inline">\(Y\)</span>. The direct effect, and an indirect effect through <span class="math inline">\(Z\)</span>. There is one additional path, <span class="math inline">\(X \leftarrow A \rightarrow Z \rightarrow Y\)</span>. Conditioning on <span class="math inline">\(A\)</span> will close the path.</p>
<div class="sourceCode" id="cb115"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dag4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/dagitty/man/dagitty.html">dagitty</a></span><span class="op">(</span><span class="st">"dag{ Y &lt;- Z &lt;- A -&gt; X -&gt; Y; X -&gt; Z }"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/dagitty/man/adjustmentSets.html">adjustmentSets</a></span><span class="op">(</span><span class="va">dag4</span>, exposure <span class="op">=</span> <span class="st">"X"</span>, outcome <span class="op">=</span> <span class="st">"Y"</span><span class="op">)</span>
<span class="co">#&gt; { A }</span></code></pre></div>
<div class="question">
<blockquote>
<p><strong>6H1.</strong> Use the Waffle House data, <code>data(WaffleDivorce)</code>, to find the total causal influence of number of Waffle Houses on divorce rate. Justify your model or models with a causal graph.</p>
</blockquote>
</div>
<p>For this problem, we’ll use the DAG given in the chapter example:</p>
<div class="sourceCode" id="cb116"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">waffle_dag</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/dagitty/man/dagitty.html">dagitty</a></span><span class="op">(</span><span class="st">"dag { S -&gt; W -&gt; D &lt;- A &lt;- S -&gt; M -&gt; D; A -&gt; M }"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/dagitty/man/coordinates.html">coordinates</a></span><span class="op">(</span><span class="va">waffle_dag</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>A <span class="op">=</span> <span class="fl">1</span>, S <span class="op">=</span> <span class="fl">1</span>, M <span class="op">=</span> <span class="fl">2</span>, W <span class="op">=</span> <span class="fl">3</span>, D <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>,
                                y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>A <span class="op">=</span> <span class="fl">1</span>, S <span class="op">=</span> <span class="fl">3</span>, M <span class="op">=</span> <span class="fl">2</span>, W <span class="op">=</span> <span class="fl">3</span>, D <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">waffle_dag</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, xend <span class="op">=</span> <span class="va">xend</span>, yend <span class="op">=</span> <span class="va">yend</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_dag_text</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span>, size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_dag_edges</span><span class="op">(</span>edge_color <span class="op">=</span> <span class="st">"black"</span>, edge_width <span class="op">=</span> <span class="fl">2</span>,
                 arrow_directed <span class="op">=</span> <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/arrow.html">arrow</a></span><span class="op">(</span>length <span class="op">=</span> <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">15</span>, <span class="st">"pt"</span><span class="op">)</span>,
                                              type <span class="op">=</span> <span class="st">"closed"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_void</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="03-causes-confounds-colliders_files/figure-html/e6h1-1-1.png" width="40%" style="display: block; margin: auto;"></div>
<p>In order to estimate the total causal effect of Waffle Houses (<span class="math inline">\(W\)</span>) on divorce rate (<span class="math inline">\(D\)</span>), we have to condition on either <span class="math inline">\(S\)</span> or both <span class="math inline">\(A\)</span> and <span class="math inline">\(M\)</span>. For simplicity, we’ll condition on only <span class="math inline">\(S\)</span>.</p>
<div class="sourceCode" id="cb117"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/dagitty/man/adjustmentSets.html">adjustmentSets</a></span><span class="op">(</span><span class="va">waffle_dag</span>, exposure <span class="op">=</span> <span class="st">"W"</span>, outcome <span class="op">=</span> <span class="st">"D"</span><span class="op">)</span>
<span class="co">#&gt; { A, M }</span>
<span class="co">#&gt; { S }</span></code></pre></div>
<p>We can use <code><a href="https://rdrr.io/pkg/brms/man/brm.html">brms::brm()</a></code> to estimate the model.</p>
<div class="sourceCode" id="cb118"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"WaffleDivorce"</span><span class="op">)</span>
<span class="va">waffle</span> <span class="op">&lt;-</span> <span class="va">WaffleDivorce</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span>D <span class="op">=</span> <span class="va">Divorce</span>,
         A <span class="op">=</span> <span class="va">MedianAgeMarriage</span>,
         M <span class="op">=</span> <span class="va">Marriage</span>,
         S <span class="op">=</span> <span class="va">South</span>,
         W <span class="op">=</span> <span class="va">WaffleHouses</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="op">-</span><span class="va">S</span>, <span class="va">standardize</span><span class="op">)</span>,
         S <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">S</span><span class="op">)</span><span class="op">)</span>

<span class="va">waff_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/brms/man/brm.html">brm</a></span><span class="op">(</span><span class="va">D</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">W</span> <span class="op">+</span> <span class="va">S</span>, data <span class="op">=</span> <span class="va">waffle</span>, family <span class="op">=</span> <span class="va">gaussian</span>,
                prior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu">normal</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.2</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">Intercept</span><span class="op">)</span>,
                          <span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu">normal</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.5</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">b</span><span class="op">)</span>,
                          <span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/brms/man/brmsfamily.html">exponential</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">sigma</span><span class="op">)</span><span class="op">)</span>,
                iter <span class="op">=</span> <span class="fl">4000</span>, warmup <span class="op">=</span> <span class="fl">2000</span>, chains <span class="op">=</span> <span class="fl">4</span>, cores <span class="op">=</span> <span class="fl">4</span>, seed <span class="op">=</span> <span class="fl">1234</span>,
                file <span class="op">=</span> <span class="fu">here</span><span class="op">(</span><span class="st">"fits"</span>, <span class="st">"chp6"</span>, <span class="st">"b6h1"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Finally, we can see the causal estimate of Waffle Houses on divorce rate by looking at the posterior distribution of the <code>b_W</code> parameter. Here, we can see that the estimate is very small, indicating that the number of Waffle Houses has little to no causal impact on the divorce rate in a state.</p>
<div class="sourceCode" id="cb119"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="http://mjskay.github.io/tidybayes/reference/spread_draws.html">spread_draws</a></span><span class="op">(</span><span class="va">waff_mod</span>, <span class="va">b_W</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">b_W</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="http://mjskay.github.io/ggdist/reference/stat_sample_slabinterval.html">stat_halfeye</a></span><span class="op">(</span>.width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.67</span>, <span class="fl">0.89</span>, <span class="fl">0.97</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">beta</span><span class="op">[</span><span class="va">W</span><span class="op">]</span><span class="op">)</span>, y <span class="op">=</span> <span class="st">"Density"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="03-causes-confounds-colliders_files/figure-html/e6h1-4-1.png" width="80%" style="display: block; margin: auto;"></div>
<div class="question">
<blockquote>
<p><strong>6H2.</strong> Build a series of models to test the implied conditional independencies of the causal graph you used in the previous problem. If any of the tests fail, how do you think the graph needs to be ammended? Does the graph need more or fewer arrows? Feel free to nominate variables that aren’t in the data.</p>
</blockquote>
</div>
<p>First we need to get the conditional independencies implied by our DAG.</p>
<div class="sourceCode" id="cb120"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/dagitty/man/impliedConditionalIndependencies.html">impliedConditionalIndependencies</a></span><span class="op">(</span><span class="va">waffle_dag</span><span class="op">)</span>
<span class="co">#&gt; A _||_ W | S</span>
<span class="co">#&gt; D _||_ S | A, M, W</span>
<span class="co">#&gt; M _||_ W | S</span></code></pre></div>
<p>There are three models we need to estimate to evaluate the implied conditional independencies. Each one can be estimated with <code><a href="https://rdrr.io/pkg/brms/man/brm.html">brms::brm()</a></code>.</p>
<div class="sourceCode" id="cb121"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">waff_ci1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/brms/man/brm.html">brm</a></span><span class="op">(</span><span class="va">A</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">W</span> <span class="op">+</span> <span class="va">S</span>, data <span class="op">=</span> <span class="va">waffle</span>, family <span class="op">=</span> <span class="va">gaussian</span>,
                prior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu">normal</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.2</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">Intercept</span><span class="op">)</span>,
                          <span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu">normal</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.5</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">b</span><span class="op">)</span>,
                          <span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/brms/man/brmsfamily.html">exponential</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">sigma</span><span class="op">)</span><span class="op">)</span>,
                iter <span class="op">=</span> <span class="fl">4000</span>, warmup <span class="op">=</span> <span class="fl">2000</span>, chains <span class="op">=</span> <span class="fl">4</span>, cores <span class="op">=</span> <span class="fl">4</span>, seed <span class="op">=</span> <span class="fl">1234</span>,
                file <span class="op">=</span> <span class="fu">here</span><span class="op">(</span><span class="st">"fits"</span>, <span class="st">"chp6"</span>, <span class="st">"b6h2-1"</span><span class="op">)</span><span class="op">)</span>

<span class="va">waff_ci2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/brms/man/brm.html">brm</a></span><span class="op">(</span><span class="va">D</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">S</span> <span class="op">+</span> <span class="va">A</span> <span class="op">+</span> <span class="va">M</span> <span class="op">+</span> <span class="va">W</span>, data <span class="op">=</span> <span class="va">waffle</span>, family <span class="op">=</span> <span class="va">gaussian</span>,
                prior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu">normal</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.2</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">Intercept</span><span class="op">)</span>,
                          <span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu">normal</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.5</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">b</span><span class="op">)</span>,
                          <span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/brms/man/brmsfamily.html">exponential</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">sigma</span><span class="op">)</span><span class="op">)</span>,
                iter <span class="op">=</span> <span class="fl">4000</span>, warmup <span class="op">=</span> <span class="fl">2000</span>, chains <span class="op">=</span> <span class="fl">4</span>, cores <span class="op">=</span> <span class="fl">4</span>, seed <span class="op">=</span> <span class="fl">1234</span>,
                file <span class="op">=</span> <span class="fu">here</span><span class="op">(</span><span class="st">"fits"</span>, <span class="st">"chp6"</span>, <span class="st">"b6h2-2"</span><span class="op">)</span><span class="op">)</span>

<span class="va">waff_ci3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/brms/man/brm.html">brm</a></span><span class="op">(</span><span class="va">M</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">W</span> <span class="op">+</span> <span class="va">S</span>, data <span class="op">=</span> <span class="va">waffle</span>, family <span class="op">=</span> <span class="va">gaussian</span>,
                prior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu">normal</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.2</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">Intercept</span><span class="op">)</span>,
                          <span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu">normal</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.5</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">b</span><span class="op">)</span>,
                          <span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/brms/man/brmsfamily.html">exponential</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">sigma</span><span class="op">)</span><span class="op">)</span>,
                iter <span class="op">=</span> <span class="fl">4000</span>, warmup <span class="op">=</span> <span class="fl">2000</span>, chains <span class="op">=</span> <span class="fl">4</span>, cores <span class="op">=</span> <span class="fl">4</span>, seed <span class="op">=</span> <span class="fl">1234</span>,
                file <span class="op">=</span> <span class="fu">here</span><span class="op">(</span><span class="st">"fits"</span>, <span class="st">"chp6"</span>, <span class="st">"b6h2-3"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Finally, we can example the posterior distributions for the implied conditional independencies. The implied conditional independency tested in the first model, <span class="math inline">\(A \!\perp\!\!\!\perp W | S\)</span>, appears to be met, as the <span class="math inline">\(beta_W\)</span> coefficient from the model is centered on zero. The same is true for the third implied conditional independency, <span class="math inline">\(M \!\perp\!\!\!\perp W | S\)</span>. The second implied conditional independency, <span class="math inline">\(D \!\perp\!\!\!\perp S | A, M, W\)</span>, is less clear, as the posterior distribution overlaps zero, but does indicate a slightly positive relationship between divorce rate a state’s “southern” status, even after adjusting for median age of marriage, marriage rate, and the number of waffle houses. This is likely because there are other variables missing from the model that are related to both divorce rate and also southerness. For example, religiosity, family size, and education could all plausibly impact divorce rates and show regional differences in the United States.</p>
<div class="sourceCode" id="cb122"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lbls</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="st">"Model 1:"</span><span class="op">~</span><span class="va">beta</span><span class="op">[</span><span class="va">W</span><span class="op">]</span><span class="op">)</span>,
          <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="st">"Model 2:"</span><span class="op">~</span><span class="va">beta</span><span class="op">[</span><span class="va">S</span><span class="op">]</span><span class="op">)</span>,
          <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="st">"Model 3:"</span><span class="op">~</span><span class="va">beta</span><span class="op">[</span><span class="va">W</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span><span class="op">(</span>
  <span class="fu"><a href="http://mjskay.github.io/tidybayes/reference/spread_draws.html">gather_draws</a></span><span class="op">(</span><span class="va">waff_ci1</span>, <span class="va">b_W</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>model <span class="op">=</span> <span class="st">"ICI 1"</span><span class="op">)</span>,
  <span class="fu"><a href="http://mjskay.github.io/tidybayes/reference/spread_draws.html">gather_draws</a></span><span class="op">(</span><span class="va">waff_ci2</span>, <span class="va">b_S1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>model <span class="op">=</span> <span class="st">"ICI 2"</span><span class="op">)</span>,
  <span class="fu"><a href="http://mjskay.github.io/tidybayes/reference/spread_draws.html">gather_draws</a></span><span class="op">(</span><span class="va">waff_ci3</span>, <span class="va">b_W</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>model <span class="op">=</span> <span class="st">"ICI 3"</span><span class="op">)</span>
<span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">.value</span>, y<span class="op">=</span> <span class="va">model</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="http://mjskay.github.io/ggdist/reference/stat_sample_slabinterval.html">stat_halfeye</a></span><span class="op">(</span>.width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.67</span>, <span class="fl">0.89</span>, <span class="fl">0.97</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html">scale_y_discrete</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="va">lbls</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Parameter Estimate"</span>, y <span class="op">=</span> <span class="st">"Implied Conditional Independency"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="03-causes-confounds-colliders_files/figure-html/e6h2-3-1.png" width="80%" style="display: block; margin: auto;"></div>
<div class="question">
<blockquote>
<p>All three problems below are based on the same data. The data in <code>data(foxes)</code> are 116 foxes from 30 different urban groups in England. These foxes are like street gangs. Group size varies from 2 to 8 individuals. Each group maintains its own urban territory. Some territories are larger than others. The <code>area</code> variable encodes this information. Some territories also have more <code>avgfood</code> than others. We want to model the <code>weight</code> of each fox. For the problems below, assume the following DAG:</p>
</blockquote>
<div class="table-question">
<img src="img/e6h-fox.png" width="40%" style="display: block; margin: auto;">
</div>
</div>
<div class="question">
<blockquote>
<p><strong>6H3.</strong> Use a model to infer the total causal influence of <code>area</code> on <code>weight</code>. Would increasing the area available to each fox make it heavier (healthier)? You might want to standardize the variables. Regardless, use prior predictive simulation to show that your model’s prior predictions stay within the possible outcome range.</p>
</blockquote>
</div>
<p>First, let’s load the data and standardize the variables.</p>
<div class="sourceCode" id="cb123"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">foxes</span><span class="op">)</span>

<span class="va">fox_dat</span> <span class="op">&lt;-</span> <span class="va">foxes</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">area</span>, <span class="va">avgfood</span>, <span class="va">weight</span>, <span class="va">groupsize</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">standardize</span><span class="op">)</span><span class="op">)</span>

<span class="va">fox_dat</span>
<span class="co">#&gt; # A tibble: 116 × 4</span>
<span class="co">#&gt;      area avgfood    weight groupsize</span>
<span class="co">#&gt;     &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt;  1 -2.24  -1.92    0.414       -1.52 </span>
<span class="co">#&gt;  2 -2.24  -1.92   -1.43        -1.52 </span>
<span class="co">#&gt;  3 -1.21  -1.12    0.676       -1.52 </span>
<span class="co">#&gt;  4 -1.21  -1.12    1.30        -1.52 </span>
<span class="co">#&gt;  5 -1.13  -1.32    1.12        -1.52 </span>
<span class="co">#&gt;  6 -1.13  -1.32   -1.08        -1.52 </span>
<span class="co">#&gt;  7 -2.02  -1.52    0.000291    -1.52 </span>
<span class="co">#&gt;  8 -2.02  -1.52   -0.371       -1.52 </span>
<span class="co">#&gt;  9  0.658 -0.0591  1.35        -0.874</span>
<span class="co">#&gt; 10  0.658 -0.0591  0.896       -0.874</span>
<span class="co">#&gt; # … with 106 more rows</span></code></pre></div>
<p>For this first question, there are no back-door paths from area to weight. All of the arrows represent indirect effects of area on weight. Therefore, we do not want to condition on <code>avgfood</code> or <code>groupsize</code>, as this would close one or more of these indirect paths which are needed to estimate the total causal effect. We can confirm with <code><a href="https://rdrr.io/pkg/dagitty/man/adjustmentSets.html">dagitty::adjustmentSets()</a></code>.</p>
<div class="sourceCode" id="cb124"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fox_dag</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/dagitty/man/dagitty.html">dagitty</a></span><span class="op">(</span><span class="st">"dag{ area -&gt; avgfood -&gt; groupsize -&gt; weight &lt;- avgfood }"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/dagitty/man/adjustmentSets.html">adjustmentSets</a></span><span class="op">(</span><span class="va">fox_dag</span>, exposure <span class="op">=</span> <span class="st">"area"</span>, outcome <span class="op">=</span> <span class="st">"weight"</span><span class="op">)</span>
<span class="co">#&gt;  {}</span></code></pre></div>
<p>Thus, our model for this question can be written as:</p>
<p><span class="math display">\[\begin{align}
  W_i &amp;\sim \text{Normal}(\mu_i, \sigma) \\
  \mu_i &amp;= \alpha + \beta_A \\
  \alpha &amp;\sim \text{Normal}(0, 0.2) \\
  \beta_A &amp;\sim \text{Normal}(0, 0.5) \\
  \sigma &amp;\sim \text{Exponential}(1)
\end{align}\]</span></p>
<p>Now, let’s do some prior predictive simulations to makes sure we’re within the bounds of what might be expected. Nearly all the lines are within the bounds of what might be expected.</p>
<div class="sourceCode" id="cb125"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">2020</span><span class="op">)</span>

<span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">1000</span>
<span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>,
       alpha <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">0</span>, <span class="fl">0.2</span><span class="op">)</span>,
       beta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">0</span>, <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/expand.html">expand</a></span><span class="op">(</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/expand.html">nesting</a></span><span class="op">(</span><span class="va">group</span>, <span class="va">alpha</span>, <span class="va">beta</span><span class="op">)</span>,
         area <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="op">-</span><span class="fl">2</span>, to <span class="op">=</span> <span class="fl">2</span>, length.out <span class="op">=</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>weight <span class="op">=</span> <span class="va">alpha</span> <span class="op">+</span> <span class="va">beta</span> <span class="op">*</span> <span class="va">area</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">area</span>, y <span class="op">=</span> <span class="va">weight</span>, group <span class="op">=</span> <span class="va">group</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">1</span> <span class="op">/</span> <span class="fl">10</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">(</span><span class="fl">0</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">foxes</span><span class="op">$</span><span class="va">weight</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">foxes</span><span class="op">$</span><span class="va">weight</span><span class="op">)</span>,
                            <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">foxes</span><span class="op">$</span><span class="va">weight</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">foxes</span><span class="op">$</span><span class="va">weight</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span>
                              <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">foxes</span><span class="op">$</span><span class="va">weight</span><span class="op">)</span><span class="op">)</span>,
             linetype <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"dashed"</span>, <span class="st">"solid"</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"text"</span>, x <span class="op">=</span> <span class="op">-</span><span class="fl">2</span>, y <span class="op">=</span> <span class="op">-</span><span class="fl">3.83</span>, hjust <span class="op">=</span> <span class="fl">0</span>, vjust <span class="op">=</span> <span class="fl">1</span>,
           label <span class="op">=</span> <span class="st">"No weight"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"text"</span>, x <span class="op">=</span> <span class="op">-</span><span class="fl">2</span>, y <span class="op">=</span> <span class="fl">2.55</span>, hjust <span class="op">=</span> <span class="fl">0</span>, vjust <span class="op">=</span> <span class="fl">0</span>,
           label <span class="op">=</span> <span class="st">"Maximum weight"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/expand_limits.html">expand_limits</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">4</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Standardized Area"</span>, y <span class="op">=</span> <span class="st">"Standardized Weight"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="03-causes-confounds-colliders_files/figure-html/e6h3-3-1.png" width="80%" style="display: block; margin: auto;"></div>
<p>Finally, we can estimate the model. Conditional on this DAG and our data, it doesn’t appear as though area size has any causal effect on the weight of foxes in this sample.</p>
<div class="sourceCode" id="cb126"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">area_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/brms/man/brm.html">brm</a></span><span class="op">(</span><span class="va">weight</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">area</span>, data <span class="op">=</span> <span class="va">fox_dat</span>, family <span class="op">=</span> <span class="va">gaussian</span>,
                prior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu">normal</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.2</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">Intercept</span><span class="op">)</span>,
                          <span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu">normal</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.5</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">b</span>,<span class="op">)</span>,
                          <span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/brms/man/brmsfamily.html">exponential</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">sigma</span><span class="op">)</span><span class="op">)</span>,
                iter <span class="op">=</span> <span class="fl">4000</span>, warmup <span class="op">=</span> <span class="fl">2000</span>, chains <span class="op">=</span> <span class="fl">4</span>, cores <span class="op">=</span> <span class="fl">4</span>, seed <span class="op">=</span> <span class="fl">1234</span>,
                file <span class="op">=</span> <span class="fu">here</span><span class="op">(</span><span class="st">"fits"</span>, <span class="st">"chp6"</span>, <span class="st">"b6h3"</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/brms/man/draws-brms.html">as_draws_df</a></span><span class="op">(</span><span class="va">area_mod</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">b_Intercept</span>, <span class="va">b_area</span>, <span class="va">sigma</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">name</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"b_Intercept"</span>, <span class="st">"b_area"</span>, <span class="st">"sigma"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">value</span>, y <span class="op">=</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_rev.html">fct_rev</a></span><span class="op">(</span><span class="va">name</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="http://mjskay.github.io/ggdist/reference/stat_sample_slabinterval.html">stat_halfeye</a></span><span class="op">(</span>.width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.67</span>, <span class="fl">0.89</span>, <span class="fl">0.97</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Parameter Estimate"</span>, y <span class="op">=</span> <span class="st">"Parameter"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="03-causes-confounds-colliders_files/figure-html/e6h3-4-1.png" width="80%" style="display: block; margin: auto;"></div>
<div class="question">
<blockquote>
<p><strong>6H4.</strong> Now infer the causal impact of adding food to a territory. Would this make foxes heavier? Which covariates do you need to adjust for to estimate the total causal influence of food?</p>
</blockquote>
</div>
<p>To estimate the total causal impact of food, we don’t need to adjust for any variables. There is a direct path from average food to weight and an indirect path through group size. If we condition on group size, then that path would be closed and we would be left with only the direct effect. However, as we want the total effect, there is no adjustment to be made.</p>
<div class="sourceCode" id="cb127"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/dagitty/man/adjustmentSets.html">adjustmentSets</a></span><span class="op">(</span><span class="va">fox_dag</span>, exposure <span class="op">=</span> <span class="st">"avgfood"</span>, outcome <span class="op">=</span> <span class="st">"weight"</span><span class="op">)</span>
<span class="co">#&gt;  {}</span></code></pre></div>
<p>When we estimate the model regressing weight on average food available, we see that there is no effect of food on weight. Given the DAG, this is expected. If there were an impact of food on weight, then we would have expected to see an impact of area on weight in the previous problem, as area is upstream of average food in the causal model.</p>
<div class="sourceCode" id="cb128"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">food_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/brms/man/brm.html">brm</a></span><span class="op">(</span><span class="va">weight</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">avgfood</span>, data <span class="op">=</span> <span class="va">fox_dat</span>, family <span class="op">=</span> <span class="va">gaussian</span>,
                prior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu">normal</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.2</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">Intercept</span><span class="op">)</span>,
                          <span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu">normal</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.5</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">b</span>,<span class="op">)</span>,
                          <span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/brms/man/brmsfamily.html">exponential</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">sigma</span><span class="op">)</span><span class="op">)</span>,
                iter <span class="op">=</span> <span class="fl">4000</span>, warmup <span class="op">=</span> <span class="fl">2000</span>, chains <span class="op">=</span> <span class="fl">4</span>, cores <span class="op">=</span> <span class="fl">4</span>, seed <span class="op">=</span> <span class="fl">1234</span>,
                file <span class="op">=</span> <span class="fu">here</span><span class="op">(</span><span class="st">"fits"</span>, <span class="st">"chp6"</span>, <span class="st">"b6h4"</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/brms/man/draws-brms.html">as_draws_df</a></span><span class="op">(</span><span class="va">food_mod</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">b_Intercept</span>, <span class="va">b_avgfood</span>, <span class="va">sigma</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">name</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"b_Intercept"</span>, <span class="st">"b_avgfood"</span>, <span class="st">"sigma"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">value</span>, y <span class="op">=</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_rev.html">fct_rev</a></span><span class="op">(</span><span class="va">name</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="http://mjskay.github.io/ggdist/reference/stat_sample_slabinterval.html">stat_halfeye</a></span><span class="op">(</span>.width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.67</span>, <span class="fl">0.89</span>, <span class="fl">0.97</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Parameter Estimate"</span>, y <span class="op">=</span> <span class="st">"Parameter"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="03-causes-confounds-colliders_files/figure-html/e6h4-2-1.png" width="80%" style="display: block; margin: auto;"></div>
<div class="question">
<blockquote>
<p><strong>6H5.</strong> Now infer the causal impact of group size. Which covariates do you need to adjust for? Looking at the posterior distribution of the resulting model, what do you think explains these data? That is, can you explain the estimates for all three problems? How do they go together?</p>
</blockquote>
</div>
<p>When assessing the causal impact of group size, there is one back-door path: <span class="math inline">\(G \leftarrow F \rightarrow W\)</span>. In this path, average food, <span class="math inline">\(F\)</span>, is a fork, so we have to condition on it to isolate the effect of group size.</p>
<div class="sourceCode" id="cb129"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/dagitty/man/adjustmentSets.html">adjustmentSets</a></span><span class="op">(</span><span class="va">fox_dag</span>, exposure <span class="op">=</span> <span class="st">"groupsize"</span>, outcome <span class="op">=</span> <span class="st">"weight"</span><span class="op">)</span>
<span class="co">#&gt; { avgfood }</span></code></pre></div>
<p>When we estimate this model, we see a negative effect for group size when controlling for food. We also now see a positive effect for average food when controlling for group size. Thus, the causal effect of group size is to decrease weight. Logically this makes sense, as there would be less food for each fox. This model also indicates that the direct effect of average food is to increase weight. That is, if group size is held constant, more food results in more weight. However, the total causal effect of food on weight, as we saw in the last problem, is nothing. This is because more food also leads to larger groups, which in turn decreases weight. This is a masking effect, also called a post-treatment bias.</p>
<div class="sourceCode" id="cb130"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">grp_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/brms/man/brm.html">brm</a></span><span class="op">(</span><span class="va">weight</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">avgfood</span> <span class="op">+</span> <span class="va">groupsize</span>, data <span class="op">=</span> <span class="va">fox_dat</span>,
               family <span class="op">=</span> <span class="va">gaussian</span>,
               prior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu">normal</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.2</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">Intercept</span><span class="op">)</span>,
                         <span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu">normal</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.5</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">b</span>,<span class="op">)</span>,
                         <span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/brms/man/brmsfamily.html">exponential</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">sigma</span><span class="op">)</span><span class="op">)</span>,
               iter <span class="op">=</span> <span class="fl">4000</span>, warmup <span class="op">=</span> <span class="fl">2000</span>, chains <span class="op">=</span> <span class="fl">4</span>, cores <span class="op">=</span> <span class="fl">4</span>, seed <span class="op">=</span> <span class="fl">1234</span>,
               file <span class="op">=</span> <span class="fu">here</span><span class="op">(</span><span class="st">"fits"</span>, <span class="st">"chp6"</span>, <span class="st">"b6h5"</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/brms/man/draws-brms.html">as_draws_df</a></span><span class="op">(</span><span class="va">grp_mod</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">b_Intercept</span>, <span class="va">b_avgfood</span>, <span class="va">b_groupsize</span>, <span class="va">sigma</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">name</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"b_Intercept"</span>, <span class="st">"b_avgfood"</span>,
                                        <span class="st">"b_groupsize"</span>, <span class="st">"sigma"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">value</span>, y <span class="op">=</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_rev.html">fct_rev</a></span><span class="op">(</span><span class="va">name</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="http://mjskay.github.io/ggdist/reference/stat_sample_slabinterval.html">stat_halfeye</a></span><span class="op">(</span>.width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.67</span>, <span class="fl">0.89</span>, <span class="fl">0.97</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Parameter Estimate"</span>, y <span class="op">=</span> <span class="st">"Parameter"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="03-causes-confounds-colliders_files/figure-html/e6h5-2-1.png" width="80%" style="display: block; margin: auto;"></div>
<div class="question">
<blockquote>
<p><strong>6H6.</strong> Consider your own research question. Draw a DAG to represent it. What are the testable implications of your DAG? Are there any variables you could condition on to close all backdoor paths? Are there unobserved variables that you have omitted? Would a reasonable colleague imagine additional threats to causal inference that you have ignored?</p>
</blockquote>
</div>
<p>For this question, we’ll use the same instructional intervention described for question <strong>6E2</strong>. The DAG is shown below. In this DAG, we’re interested in the effect of a new professional development intervention (<span class="math inline">\(D\)</span>) on student performance (<span class="math inline">\(P\)</span>). However, the professional development works by improving the teacher’s instruction (<span class="math inline">\(I\)</span>), and student performance is also affected by the students’ pre-existing knowledge (<span class="math inline">\(K\)</span>).</p>
<div class="sourceCode" id="cb131"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ed_dag</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/dagitty/man/dagitty.html">dagitty</a></span><span class="op">(</span><span class="st">"dag { D -&gt; I -&gt; P &lt;- K }"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/dagitty/man/coordinates.html">coordinates</a></span><span class="op">(</span><span class="va">ed_dag</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>D <span class="op">=</span> <span class="fl">1</span>, I <span class="op">=</span> <span class="fl">1.5</span>, P <span class="op">=</span> <span class="fl">2</span>, K <span class="op">=</span> <span class="fl">2.5</span><span class="op">)</span>,
                            y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>D <span class="op">=</span> <span class="fl">3</span>, I <span class="op">=</span> <span class="fl">2</span>, P <span class="op">=</span> <span class="fl">1</span>, K <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">ed_dag</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, xend <span class="op">=</span> <span class="va">xend</span>, yend <span class="op">=</span> <span class="va">yend</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_dag_text</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span>, size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_dag_edges</span><span class="op">(</span>edge_color <span class="op">=</span> <span class="st">"black"</span>, edge_width <span class="op">=</span> <span class="fl">2</span>,
                 arrow_directed <span class="op">=</span> <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/arrow.html">arrow</a></span><span class="op">(</span>length <span class="op">=</span> <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">15</span>, <span class="st">"pt"</span><span class="op">)</span>,
                                              type <span class="op">=</span> <span class="st">"closed"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_void</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="03-causes-confounds-colliders_files/figure-html/e6h6-1-1.png" width="40%" style="display: block; margin: auto;"></div>
<p>Based on this DAG, there are three testable implications:</p>
<ol style="list-style-type: decimal">
<li><span class="math inline">\(D \!\perp\!\!\!\perp K\)</span></li>
<li><span class="math inline">\(D \!\perp\!\!\!\perp P | I\)</span></li>
<li><span class="math inline">\(I \!\perp\!\!\!\perp K\)</span></li>
</ol>
<div class="sourceCode" id="cb132"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/dagitty/man/impliedConditionalIndependencies.html">impliedConditionalIndependencies</a></span><span class="op">(</span><span class="va">ed_dag</span><span class="op">)</span>
<span class="co">#&gt; D _||_ K</span>
<span class="co">#&gt; D _||_ P | I</span>
<span class="co">#&gt; I _||_ K</span></code></pre></div>
<p>If we are interested in the causal impact of the professional development intervention <span class="math inline">\(D\)</span> on student performance <span class="math inline">\(P\)</span>, then there are no back-door paths to close. Conditioning on the quality of instruction would introduce a post-treatment bias that would mask the effect of the professional development on the student performance.</p>
<div class="sourceCode" id="cb133"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/dagitty/man/adjustmentSets.html">adjustmentSets</a></span><span class="op">(</span><span class="va">ed_dag</span>, exposure <span class="op">=</span> <span class="st">"D"</span>, outcome <span class="op">=</span> <span class="st">"P"</span><span class="op">)</span>
<span class="co">#&gt;  {}</span></code></pre></div>
<p>There are many other factors not included in this DAG that are known to have an impact both on quality of instruction and student performance. These could include the socioeconomic and socioemotional state of the student, student motivation, school funding, class size, and at-home educational support, to name just a few. Students are also grouped into classes and schools, so there are likely group-level effects that are not accounted for here.</p>
<div class="question">
<blockquote>
<p><strong>6H7.</strong> For the DAG you made in the previous problem, can you write a data generating simulation for it? Can you design one or more statistical models to produce causal estimates? If so, try to calculate interesting counterfactuals. If not, use the simulation to estimate the size of the bias you might expect. Under what conditions would you, for example, infer the opposite of a true causal effect?</p>
</blockquote>
</div>
<p>Given the DAG, we can generate data and estimate some causal models to test it. First, let’s generate data. For the sake of this example, we’ll assume there are no group level effects and that all teachers are equally effective. These assumptions wouldn’t hold in real data, but will suffice for this exercise.</p>
<div class="sourceCode" id="cb134"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">2010</span><span class="op">)</span>

<span class="va">students</span> <span class="op">&lt;-</span> <span class="fl">500</span>

<span class="va">ed_dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>k <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">students</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,
                 d <span class="op">=</span> <span class="fu"><a href="https://mc-stan.org/cmdstanr/reference/model-method-sample.html">sample</a></span><span class="op">(</span><span class="fl">0L</span><span class="op">:</span><span class="fl">1L</span>, <span class="va">students</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
                 i <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">students</span>, mean <span class="op">=</span> <span class="fl">1</span> <span class="op">+</span> <span class="fl">3</span> <span class="op">*</span> <span class="va">d</span><span class="op">)</span>,
                 p <span class="op">=</span> <span class="va">k</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">students</span>, <span class="fl">0.8</span> <span class="op">*</span> <span class="va">i</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu">where</span><span class="op">(</span><span class="va">is.double</span><span class="op">)</span>, <span class="va">standardize</span><span class="op">)</span><span class="op">)</span>

<span class="va">ed_dat</span>
<span class="co">#&gt; # A tibble: 500 × 4</span>
<span class="co">#&gt;          k     d        i      p</span>
<span class="co">#&gt;      &lt;dbl&gt; &lt;int&gt;    &lt;dbl&gt;  &lt;dbl&gt;</span>
<span class="co">#&gt;  1 -0.472      1  1.61     1.05 </span>
<span class="co">#&gt;  2  0.0678     1  0.986    0.973</span>
<span class="co">#&gt;  3  1.09       1  1.05     1.42 </span>
<span class="co">#&gt;  4  0.290      0 -1.60    -0.385</span>
<span class="co">#&gt;  5 -0.131      1  1.28     0.731</span>
<span class="co">#&gt;  6  1.54       0 -0.00907  1.11 </span>
<span class="co">#&gt;  7 -0.474      0 -1.35    -0.794</span>
<span class="co">#&gt;  8 -1.47       1  0.345   -0.425</span>
<span class="co">#&gt;  9  0.735      0 -0.559    0.439</span>
<span class="co">#&gt; 10  0.695      0 -0.372    0.155</span>
<span class="co">#&gt; # … with 490 more rows</span></code></pre></div>
<p>Now let’s estimate a model to find the causal effect of professional development on student performance.</p>
<p><span class="math display">\[\begin{align}
  P_i &amp;\sim \text{Normal}(\mu_i, \sigma) \\
  \mu_i &amp;= \alpha + \beta_D \\
  \alpha &amp;\sim \text{Normal}(0,0.2) \\
  \beta_D &amp;\sim \text{Normal}(0,0.5) \\
  \sigma &amp;\sim \text{Exponential}(1)
\end{align}\]</span></p>
<div class="sourceCode" id="cb135"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ed_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/brms/man/brm.html">brm</a></span><span class="op">(</span><span class="va">p</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">d</span>, data <span class="op">=</span> <span class="va">ed_dat</span>, family <span class="op">=</span> <span class="va">gaussian</span>,
              prior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu">normal</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.2</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">Intercept</span><span class="op">)</span>,
                        <span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu">normal</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.5</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">b</span><span class="op">)</span>,
                        <span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/brms/man/brmsfamily.html">exponential</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">sigma</span><span class="op">)</span><span class="op">)</span>,
              iter <span class="op">=</span> <span class="fl">4000</span>, warmup <span class="op">=</span> <span class="fl">2000</span>, chains <span class="op">=</span> <span class="fl">4</span>, cores <span class="op">=</span> <span class="fl">4</span>, seed <span class="op">=</span> <span class="fl">1234</span>,
              file <span class="op">=</span> <span class="fu">here</span><span class="op">(</span><span class="st">"fits"</span>, <span class="st">"chp6"</span>, <span class="st">"b6h7-causal"</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/brms/man/draws-brms.html">as_draws_df</a></span><span class="op">(</span><span class="va">ed_mod</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">b_Intercept</span>, <span class="va">b_d</span>, <span class="va">sigma</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">value</span>, y <span class="op">=</span> <span class="va">name</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="http://mjskay.github.io/ggdist/reference/stat_sample_slabinterval.html">stat_halfeye</a></span><span class="op">(</span>.width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.67</span>, <span class="fl">0.89</span>, <span class="fl">0.97</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Parameter Value"</span>, y <span class="op">=</span> <span class="st">"Parameter"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="03-causes-confounds-colliders_files/figure-html/e6h7-2-1.png" width="80%" style="display: block; margin: auto;"></div>
<p>Here we can see that, as expected given the data is simulated, there is a strong effect of professional development on student performance. With students whose teachers received the professional development showing a 0.88 standard deviation increase in performance compared to students whose teachers did not receive the professional development.</p>
</div>
</div>
<div id="homework-2" class="section level2" number="3.3">
<h2>
<span class="header-section-number">3.3</span> Homework<a class="anchor" aria-label="anchor" href="#homework-2"><i class="fas fa-link"></i></a>
</h2>
<div class="question">
<blockquote>
<p><strong>1.</strong> The first two problems are based on the same data. The data in <code>data(foxes)</code> are 116 foxes from 30 different urban groups in England. These fox groups are like street gangs. Group size (<code>groupsize</code>) varies from 2 to 8 individuals. Each group maintains its own (almost exclusive) urban territory. Some territories are larger tahn others. The <code>area</code> variable encodes this information. Some territories also have more <code>avgfood</code> than others. And food influences the <code>weight</code> of each fox. Assume this DAG:</p>
</blockquote>
<div class="table-question">
<img src="img/w3h1-fox.png" width="40%" style="display: block; margin: auto;">
</div>
<blockquote>
<p>where <span class="math inline">\(F\)</span> is <code>avgfood</code>, <span class="math inline">\(G\)</span> is <code>groupsize</code>, <span class="math inline">\(A\)</span> is <code>area</code>, and <span class="math inline">\(W\)</span> is <code>weight</code>.</p>
</blockquote>
<blockquote>
<p>Use the backdoor criterion and estimate the total causal influence of <span class="math inline">\(A\)</span> on <span class="math inline">\(F\)</span>. What effect would increasing the area of a territory have on the amount of food inside it?</p>
</blockquote>
</div>
<p>There is only one path from <span class="math inline">\(A\)</span> to <span class="math inline">\(F\)</span>, the direct path. Thus there are no backdoors, and no additional variables that need to be included in the model. We can confirm with dagitty.</p>
<div class="sourceCode" id="cb136"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fox_dag</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/dagitty/man/dagitty.html">dagitty</a></span><span class="op">(</span><span class="st">"dag{ A -&gt; F -&gt; G -&gt; W &lt;- F }"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/dagitty/man/adjustmentSets.html">adjustmentSets</a></span><span class="op">(</span><span class="va">fox_dag</span>, exposure <span class="op">=</span> <span class="st">"A"</span>, outcome <span class="op">=</span> <span class="st">"F"</span><span class="op">)</span>
<span class="co">#&gt;  {}</span></code></pre></div>
<p>Given that, we can estimate our model with {brms}. We’ll standardize the variables to make setting the priors easier.</p>
<div class="sourceCode" id="cb137"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">foxes</span><span class="op">)</span>

<span class="va">fox_dat</span> <span class="op">&lt;-</span> <span class="va">foxes</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">area</span>, <span class="va">avgfood</span>, <span class="va">weight</span>, <span class="va">groupsize</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">standardize</span><span class="op">)</span><span class="op">)</span>

<span class="va">food_on_area</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/brms/man/brm.html">brm</a></span><span class="op">(</span><span class="va">avgfood</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">area</span>, data <span class="op">=</span> <span class="va">fox_dat</span>, family <span class="op">=</span> <span class="va">gaussian</span>,
                    prior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu">normal</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.2</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">Intercept</span><span class="op">)</span>,
                              <span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu">normal</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.5</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">b</span>,<span class="op">)</span>,
                              <span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/brms/man/brmsfamily.html">exponential</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">sigma</span><span class="op">)</span><span class="op">)</span>,
                    iter <span class="op">=</span> <span class="fl">4000</span>, warmup <span class="op">=</span> <span class="fl">2000</span>, chains <span class="op">=</span> <span class="fl">4</span>, cores <span class="op">=</span> <span class="fl">4</span>, seed <span class="op">=</span> <span class="fl">1234</span>,
                    file <span class="op">=</span> <span class="fu">here</span><span class="op">(</span><span class="st">"fits"</span>, <span class="st">"hw3"</span>, <span class="st">"w3h1"</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://mc-stan.org/cmdstanr/reference/fit-method-summary.html">summary</a></span><span class="op">(</span><span class="va">food_on_area</span><span class="op">)</span>
<span class="co">#&gt;  Family: gaussian </span>
<span class="co">#&gt;   Links: mu = identity; sigma = identity </span>
<span class="co">#&gt; Formula: avgfood ~ 1 + area </span>
<span class="co">#&gt;    Data: fox_dat (Number of observations: 116) </span>
<span class="co">#&gt;   Draws: 4 chains, each with iter = 2000; warmup = 0; thin = 1;</span>
<span class="co">#&gt;          total post-warmup draws = 8000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Population-Level Effects: </span>
<span class="co">#&gt;           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS</span>
<span class="co">#&gt; Intercept     0.00      0.04    -0.09     0.09 1.00     8076     6131</span>
<span class="co">#&gt; area          0.88      0.04     0.79     0.96 1.00     8389     5927</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Family Specific Parameters: </span>
<span class="co">#&gt;       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS</span>
<span class="co">#&gt; sigma     0.48      0.03     0.42     0.54 1.00     7997     6226</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Draws were sampled using sample(hmc). For each parameter, Bulk_ESS</span>
<span class="co">#&gt; and Tail_ESS are effective sample size measures, and Rhat is the potential</span>
<span class="co">#&gt; scale reduction factor on split chains (at convergence, Rhat = 1).</span></code></pre></div>
<p>We see a fairly strong effect of area on the average amount of food. The credible interval for <code>area</code> is well above zero. For an increase of 1 standard deviation in <code>area</code> we would expect to see about a .9 standard deviation increase in <code>food</code>. Logically this makes sense, as a greater area means there are would be more prey available.</p>
<div class="question">
<blockquote>
<p><strong>2.</strong> Now infer both the <strong>total</strong> and <strong>direct</strong> causal effects of adding food <span class="math inline">\(F\)</span> to a territory on the weight <span class="math inline">\(W\)</span> of foxes. Which covariates do you need to adjust for in each case? In light of your estimates from this problem and the previous one, what do you think is going on with these foxes? Feel free to speculate—all that matters is that you justify your speculation.</p>
</blockquote>
</div>
<p>There are no backdoor paths from <span class="math inline">\(F\)</span> to <span class="math inline">\(W\)</span>, so there are no covariates that need to be added when evaluating the total effect of food on weight. If we want the direct effect, then we need to close the path of <span class="math inline">\(F \rightarrow G \rightarrow W\)</span> by adding group size as a covariate. We can again confirm with dagitty.</p>
<div class="sourceCode" id="cb138"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/dagitty/man/adjustmentSets.html">adjustmentSets</a></span><span class="op">(</span><span class="va">fox_dag</span>, exposure <span class="op">=</span> <span class="st">"F"</span>, outcome <span class="op">=</span> <span class="st">"W"</span>, effect <span class="op">=</span> <span class="st">"total"</span><span class="op">)</span>
<span class="co">#&gt;  {}</span>

<span class="fu"><a href="https://rdrr.io/pkg/dagitty/man/adjustmentSets.html">adjustmentSets</a></span><span class="op">(</span><span class="va">fox_dag</span>, exposure <span class="op">=</span> <span class="st">"F"</span>, outcome <span class="op">=</span> <span class="st">"W"</span>, effect <span class="op">=</span> <span class="st">"direct"</span><span class="op">)</span>
<span class="co">#&gt; { G }</span></code></pre></div>
<p>Now we estimate our models. First the total effect. In this model we see basically no effect of food on weight. The 95% interval in the {brms} output is -0.21 to 0.15 with a mean of -0.02. So the effect is just as likely to be positive as negative.</p>
<div class="sourceCode" id="cb139"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">food_total</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/brms/man/brm.html">brm</a></span><span class="op">(</span><span class="va">weight</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">avgfood</span>, data <span class="op">=</span> <span class="va">fox_dat</span>, family <span class="op">=</span> <span class="va">gaussian</span>,
                  prior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu">normal</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.2</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">Intercept</span><span class="op">)</span>,
                            <span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu">normal</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.5</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">b</span>,<span class="op">)</span>,
                            <span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/brms/man/brmsfamily.html">exponential</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">sigma</span><span class="op">)</span><span class="op">)</span>,
                  iter <span class="op">=</span> <span class="fl">4000</span>, warmup <span class="op">=</span> <span class="fl">2000</span>, chains <span class="op">=</span> <span class="fl">4</span>, cores <span class="op">=</span> <span class="fl">4</span>, seed <span class="op">=</span> <span class="fl">1234</span>,
                  file <span class="op">=</span> <span class="fu">here</span><span class="op">(</span><span class="st">"fits"</span>, <span class="st">"hw3"</span>, <span class="st">"w3h2-total"</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://mc-stan.org/cmdstanr/reference/fit-method-summary.html">summary</a></span><span class="op">(</span><span class="va">food_total</span><span class="op">)</span>
<span class="co">#&gt;  Family: gaussian </span>
<span class="co">#&gt;   Links: mu = identity; sigma = identity </span>
<span class="co">#&gt; Formula: weight ~ 1 + avgfood </span>
<span class="co">#&gt;    Data: fox_dat (Number of observations: 116) </span>
<span class="co">#&gt;   Draws: 4 chains, each with iter = 2000; warmup = 0; thin = 1;</span>
<span class="co">#&gt;          total post-warmup draws = 8000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Population-Level Effects: </span>
<span class="co">#&gt;           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS</span>
<span class="co">#&gt; Intercept    -0.00      0.08    -0.17     0.16 1.00     7369     5854</span>
<span class="co">#&gt; avgfood      -0.02      0.09    -0.21     0.15 1.00     7826     6205</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Family Specific Parameters: </span>
<span class="co">#&gt;       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS</span>
<span class="co">#&gt; sigma     1.01      0.07     0.89     1.15 1.00     7839     6107</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Draws were sampled using sample(hmc). For each parameter, Bulk_ESS</span>
<span class="co">#&gt; and Tail_ESS are effective sample size measures, and Rhat is the potential</span>
<span class="co">#&gt; scale reduction factor on split chains (at convergence, Rhat = 1).</span></code></pre></div>
<p>Next we estimate the direct effect. Here we see that when we stratify by group size, we see a strong positive effect of food on weight. This indicates that within a given group size, more food is associated with more weight.</p>
<div class="sourceCode" id="cb140"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">food_direct</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/brms/man/brm.html">brm</a></span><span class="op">(</span><span class="va">weight</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">avgfood</span> <span class="op">+</span> <span class="va">groupsize</span>, data <span class="op">=</span> <span class="va">fox_dat</span>,
                   family <span class="op">=</span> <span class="va">gaussian</span>,
                   prior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu">normal</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.2</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">Intercept</span><span class="op">)</span>,
                             <span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu">normal</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.5</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">b</span>,<span class="op">)</span>,
                             <span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/brms/man/brmsfamily.html">exponential</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">sigma</span><span class="op">)</span><span class="op">)</span>,
                   iter <span class="op">=</span> <span class="fl">4000</span>, warmup <span class="op">=</span> <span class="fl">2000</span>, chains <span class="op">=</span> <span class="fl">4</span>, cores <span class="op">=</span> <span class="fl">4</span>, seed <span class="op">=</span> <span class="fl">1234</span>,
                   file <span class="op">=</span> <span class="fu">here</span><span class="op">(</span><span class="st">"fits"</span>, <span class="st">"hw3"</span>, <span class="st">"w3h2-direct"</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://mc-stan.org/cmdstanr/reference/fit-method-summary.html">summary</a></span><span class="op">(</span><span class="va">food_direct</span><span class="op">)</span>
<span class="co">#&gt;  Family: gaussian </span>
<span class="co">#&gt;   Links: mu = identity; sigma = identity </span>
<span class="co">#&gt; Formula: weight ~ 1 + avgfood + groupsize </span>
<span class="co">#&gt;    Data: fox_dat (Number of observations: 116) </span>
<span class="co">#&gt;   Draws: 4 chains, each with iter = 2000; warmup = 0; thin = 1;</span>
<span class="co">#&gt;          total post-warmup draws = 8000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Population-Level Effects: </span>
<span class="co">#&gt;           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS</span>
<span class="co">#&gt; Intercept    -0.00      0.08    -0.16     0.16 1.00     5680     4403</span>
<span class="co">#&gt; avgfood       0.47      0.18     0.11     0.84 1.00     4022     3986</span>
<span class="co">#&gt; groupsize    -0.57      0.19    -0.93    -0.21 1.00     4021     4085</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Family Specific Parameters: </span>
<span class="co">#&gt;       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS</span>
<span class="co">#&gt; sigma     0.96      0.06     0.85     1.09 1.00     5544     5204</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Draws were sampled using sample(hmc). For each parameter, Bulk_ESS</span>
<span class="co">#&gt; and Tail_ESS are effective sample size measures, and Rhat is the potential</span>
<span class="co">#&gt; scale reduction factor on split chains (at convergence, Rhat = 1).</span></code></pre></div>
<p>Altogether, these results seem to suggest a masking effect. That is, as more food is available, more foxes move into the territory, increasing the group size. This continues until an equilibrium is reached where the amount of food available is equally good (or equally bad) within each territory. Thus, the total effect of food is negligible because as more food becomes available, the group size increases such that the amount of food available for each individual fox remains relatively stable.</p>
<div class="question">
<blockquote>
<p><strong>3.</strong> Reconsider the Table 2 Fallacy example (from Lecture 6), this time with an unobserved confound <span class="math inline">\(U\)</span> that influences both smoking <span class="math inline">\(S\)</span> and stroke <span class="math inline">\(Y\)</span>. Here’s the modified DAG:</p>
</blockquote>
<div class="table-question">
<img src="img/w3h3-stroke.png" width="40%" style="display: block; margin: auto;">
</div>
<blockquote>
<p>First use the backdoor criterion to determine and adjustment set that allows you to estimate the causal effect of <span class="math inline">\(X\)</span> on <span class="math inline">\(Y\)</span>, i.e., <span class="math inline">\(P(Y|\text{do}(X))\)</span>. Second explain the proper interpretation of each coefficient implied by the regression model that corresponds to the adjustment set. Which coefficients (slopes) are causal and which are not? There is no need to fit any models. Just think through the implications.</p>
</blockquote>
</div>
<p>There are 5 paths from <span class="math inline">\(X\)</span> to <span class="math inline">\(Y\)</span>:</p>
<ol style="list-style-type: decimal">
<li><span class="math inline">\(X \rightarrow Y\)</span></li>
<li><span class="math inline">\(X \leftarrow S \rightarrow Y\)</span></li>
<li><span class="math inline">\(X \leftarrow A \rightarrow Y\)</span></li>
<li><span class="math inline">\(X \leftarrow A \rightarrow S \rightarrow Y\)</span></li>
<li><span class="math inline">\(X \leftarrow A \rightarrow S \leftarrow U \rightarrow Y\)</span></li>
</ol>
<p>Path 1 is the effect of <span class="math inline">\(X\)</span> on <span class="math inline">\(Y\)</span>, which we want. The rest are backdoor paths which must be closed. Conditioning on <span class="math inline">\(A\)</span> and <span class="math inline">\(S\)</span> will close all of the paths, which we can confirm with dagitty.</p>
<div class="sourceCode" id="cb141"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">stroke_dag</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/dagitty/man/dagitty.html">dagitty</a></span><span class="op">(</span><span class="st">"dag{
  A -&gt; S -&gt; X -&gt; Y;
  A -&gt; X; A -&gt; Y; S -&gt; Y;
  S &lt;- U -&gt; Y 
  X [exposure]
  Y [outcome]
  U [unobserved]
}"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/dagitty/man/adjustmentSets.html">adjustmentSets</a></span><span class="op">(</span><span class="va">stroke_dag</span><span class="op">)</span>
<span class="co">#&gt; { A, S }</span></code></pre></div>
<p>However, the unobserved variable <span class="math inline">\(U\)</span> has important implications for the interpretation of the model. There are three slope coefficients that would be in the canonical Table 2: <span class="math inline">\(\beta_X\)</span>, <span class="math inline">\(\beta_S\)</span>, and <span class="math inline">\(\beta_A\)</span>. The focus of our investigation, <span class="math inline">\(\beta_X\)</span> represents the causal effect of <span class="math inline">\(X\)</span> on <span class="math inline">\(Y\)</span>. However, because <span class="math inline">\(S\)</span> is a collider, both <span class="math inline">\(\beta_S\)</span> and <span class="math inline">\(\beta_A\)</span> are confounded by <span class="math inline">\(U\)</span>. Thus, these coefficients should not be interpreted as any type of causal effect.</p>
<div class="question">
<blockquote>
<p><strong>4 - OPTIONAL CHALLENGE.</strong> Write a synthetic data simulation for the causal model shown in <strong>Problem 3</strong>. Be sure to include the unobserved confound in the simulation. Choose any functional relationships that you like—you don’t have to get the epidemiology correct. You just need to honor the causal structure. Then design a regression model to estimate the influence of <span class="math inline">\(X\)</span> on <span class="math inline">\(Y\)</span> and use it on your synthetic data. How large of a sample do you need to reliably estimate <span class="math inline">\(P(Y|\text{do}(X))\)</span>? Define “reliably” as you like, but justify your definition.</p>
</blockquote>
</div>
<p>Since we’re going to be simulating a bunch a data sets, we’ll start by writing a function that will generate a single data set based on the DAG. The function allows us to specify a sample size and the relationship between <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>. Notice that although <span class="math inline">\(U\)</span> is used to generate the data, the variable is removed before return the data set, as it is unobserved (<code>select(-U)</code>).</p>
<div class="sourceCode" id="cb142"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sim_dat</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span> <span class="op">=</span> <span class="fl">100</span>, <span class="va">bx</span> <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>U <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>,
         A <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>S <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n</span>, <span class="va">A</span> <span class="op">+</span> <span class="va">U</span>, <span class="fl">1</span><span class="op">)</span>,
           X <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n</span>, <span class="va">A</span> <span class="op">+</span> <span class="va">S</span>, <span class="fl">1</span><span class="op">)</span>,
           Y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n</span>, <span class="va">A</span> <span class="op">+</span> <span class="va">S</span> <span class="op">+</span> <span class="op">(</span><span class="va">bx</span> <span class="op">*</span> <span class="va">X</span><span class="op">)</span> <span class="op">+</span> <span class="va">U</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">U</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">standardize</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>We’ll test one example data set. We use the <code>sim_dat()</code> function we just created to generate a data set with 10 subjects and a positive relationship between <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> of 0.3.</p>
<div class="sourceCode" id="cb143"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dat1</span> <span class="op">&lt;-</span> <span class="fu">sim_dat</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span>, bx <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span>

<span class="va">mod1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/brms/man/brm.html">brm</a></span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">X</span> <span class="op">+</span> <span class="va">S</span> <span class="op">+</span> <span class="va">A</span>, data <span class="op">=</span> <span class="va">dat1</span>, family <span class="op">=</span> <span class="va">gaussian</span>,
            prior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu">normal</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.2</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">Intercept</span><span class="op">)</span>,
                      <span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu">normal</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.5</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">b</span>,<span class="op">)</span>,
                      <span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/brms/man/brmsfamily.html">exponential</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">sigma</span><span class="op">)</span><span class="op">)</span>,
            iter <span class="op">=</span> <span class="fl">4000</span>, warmup <span class="op">=</span> <span class="fl">2000</span>, chains <span class="op">=</span> <span class="fl">4</span>, cores <span class="op">=</span> <span class="fl">4</span>, seed <span class="op">=</span> <span class="fl">1234</span>,
            file <span class="op">=</span> <span class="fu">here</span><span class="op">(</span><span class="st">"fits"</span>, <span class="st">"hw3"</span>, <span class="st">"w3h4"</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://mc-stan.org/cmdstanr/reference/fit-method-summary.html">summary</a></span><span class="op">(</span><span class="va">mod1</span>, prob <span class="op">=</span> <span class="fl">0.89</span><span class="op">)</span>
<span class="co">#&gt;  Family: gaussian </span>
<span class="co">#&gt;   Links: mu = identity; sigma = identity </span>
<span class="co">#&gt; Formula: Y ~ 1 + X + S + A </span>
<span class="co">#&gt;    Data: dat1 (Number of observations: 10) </span>
<span class="co">#&gt;   Draws: 4 chains, each with iter = 2000; warmup = 0; thin = 1;</span>
<span class="co">#&gt;          total post-warmup draws = 8000</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Population-Level Effects: </span>
<span class="co">#&gt;           Estimate Est.Error l-89% CI u-89% CI Rhat Bulk_ESS Tail_ESS</span>
<span class="co">#&gt; Intercept     0.00      0.07    -0.11     0.11 1.00     4872     3998</span>
<span class="co">#&gt; X             0.37      0.28    -0.09     0.82 1.00     2809     3786</span>
<span class="co">#&gt; S             0.75      0.15     0.51     0.98 1.00     3526     4020</span>
<span class="co">#&gt; A            -0.14      0.23    -0.49     0.23 1.00     3348     4173</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Family Specific Parameters: </span>
<span class="co">#&gt;       Estimate Est.Error l-89% CI u-89% CI Rhat Bulk_ESS Tail_ESS</span>
<span class="co">#&gt; sigma     0.24      0.08     0.14     0.38 1.00     2994     3461</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Draws were sampled using sample(hmc). For each parameter, Bulk_ESS</span>
<span class="co">#&gt; and Tail_ESS are effective sample size measures, and Rhat is the potential</span>
<span class="co">#&gt; scale reduction factor on split chains (at convergence, Rhat = 1).</span></code></pre></div>
<p>And it worked! We got back an estimate of <span class="math inline">\(X\)</span> very close to 0.3, and equally likely to be positive or negative. This was with a sample size of only 10.</p>
<p>The question asks us what sample size is needed for a <em>reliable</em> estimate of <span class="math inline">\(\beta_X\)</span>. There are two ways (at least) we could think about this. The first is how “correct” our estimate is on average. That is, the mean difference between the true value (0.3 in our example data set) and the estimated posterior mean (0.37 in the above model summary). Thus, the difference here is 0.07. This measure is also referred to as the mean absolute difference. Here, absolute indicates that we normally take the absolute value of the difference so that positive and negative deviations don’t cancel each other out.</p>
<p>The other measure of reliability we might consider is the width of our chosen credible interval. If the posterior interval is very wide, we might say that we have an unreliable estimate of <span class="math inline">\(\beta_X\)</span>, because there are a wide range of values the model views as plausible. A smaller interval would be more reliable, because this would indicate a high degree of confidence that our estimate is in a more narrow range of values.</p>
<p>In the simulation, we’ll generate 100 data sets with each sample size, fit a model to each data set, and calculate our outcome measures. To make things easier, we’ll build another function. First we generate the data, then fit the model (<code><a href="https://rdrr.io/r/base/message.html">suppressMessages()</a></code> and <code><a href="https://rdrr.io/r/utils/capture.output.html">capture.output()</a></code> just suppress the model fitting messages since we’ll be fitting many models), and then we use <code><a href="http://mjskay.github.io/ggdist/reference/point_interval.html">mean_hdi()</a></code> to calculate our measures of reliability.</p>
<div class="sourceCode" id="cb144"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sim_func</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span>, <span class="va">bx</span> <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu">sim_dat</span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span>, bx <span class="op">=</span> <span class="va">bx</span><span class="op">)</span>
  
  <span class="fu"><a href="https://rdrr.io/r/base/message.html">suppressMessages</a></span><span class="op">(</span><span class="va">output</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/capture.output.html">capture.output</a></span><span class="op">(</span>
    <span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/brms/man/brm.html">brm</a></span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">X</span> <span class="op">+</span> <span class="va">S</span> <span class="op">+</span> <span class="va">A</span>, data <span class="op">=</span> <span class="va">dat</span>, family <span class="op">=</span> <span class="va">gaussian</span>,
               prior <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu">normal</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.2</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">Intercept</span><span class="op">)</span>,
                         <span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu">normal</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.5</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">b</span>,<span class="op">)</span>,
                         <span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html">prior</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/brms/man/brmsfamily.html">exponential</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, class <span class="op">=</span> <span class="va">sigma</span><span class="op">)</span><span class="op">)</span>,
               refresh <span class="op">=</span> <span class="fl">0</span>,
               iter <span class="op">=</span> <span class="fl">4000</span>, warmup <span class="op">=</span> <span class="fl">2000</span>, chains <span class="op">=</span> <span class="fl">4</span>, cores <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>
  <span class="op">)</span><span class="op">)</span>
  
  <span class="fu"><a href="https://rdrr.io/pkg/brms/man/draws-brms.html">as_draws_df</a></span><span class="op">(</span><span class="va">mod</span>, <span class="st">"b_X"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu"><a href="http://mjskay.github.io/ggdist/reference/point_interval.html">mean_hdi</a></span><span class="op">(</span>.width <span class="op">=</span> <span class="fl">0.89</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>abs_error <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">b_X</span> <span class="op">-</span> <span class="va">bx</span><span class="op">)</span>,
           int_width <span class="op">=</span> <span class="va">.upper</span> <span class="op">-</span> <span class="va">.lower</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">abs_error</span>, <span class="va">int_width</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>We’ll investigate sample sizes of 10, 20, 50, 100, 250, 500, and 1,000. For each sample size, we’ll conduct 100 replications (i.e., 100 data sets per sample size condition). The following code will create 100 rows for each sample size, and then apply our <code>sim_func()</code> to the sample size of each row.</p>
<div class="sourceCode" id="cb145"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sim_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/expand_grid.html">expand_grid</a></span><span class="op">(</span>sample_size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">20</span>, <span class="fl">50</span>, <span class="fl">100</span>, <span class="fl">250</span>, <span class="fl">500</span>, <span class="fl">1000</span><span class="op">)</span>,
                           replication <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>results <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/rethinking/man/quap.html">map</a></span><span class="op">(</span><span class="va">sample_size</span>, <span class="va">sim_func</span>, bx <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html">unnest</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://readr.tidyverse.org/reference/read_rds.html">write_rds</a></span><span class="op">(</span><span class="fu">here</span><span class="op">(</span><span class="st">"fits"</span>, <span class="st">"hw3"</span>, <span class="st">"w3h4-sim.rds"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Looking at our results we can see for each replication, the absolute value of the difference between the mean of the posterior and the true value (0.3; <code>abs_error</code>), as well as the width of the 89% compatibility interval.</p>
<div class="sourceCode" id="cb146"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sim_results</span>
<span class="co">#&gt; # A tibble: 700 × 4</span>
<span class="co">#&gt;    sample_size replication abs_error int_width</span>
<span class="co">#&gt;          &lt;dbl&gt;       &lt;int&gt;     &lt;dbl&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt;  1          10           1    0.206      0.774</span>
<span class="co">#&gt;  2          10           2    0.265      1.08 </span>
<span class="co">#&gt;  3          10           3    0.0771     0.907</span>
<span class="co">#&gt;  4          10           4    0.378      0.954</span>
<span class="co">#&gt;  5          10           5    0.109      0.991</span>
<span class="co">#&gt;  6          10           6    0.0423     0.970</span>
<span class="co">#&gt;  7          10           7    0.460      0.764</span>
<span class="co">#&gt;  8          10           8    0.0568     0.999</span>
<span class="co">#&gt;  9          10           9    0.0854     0.706</span>
<span class="co">#&gt; 10          10          10    0.0566     1.01 </span>
<span class="co">#&gt; # … with 690 more rows</span></code></pre></div>
<p>Across all replications, we see that the that average absolute error is similar for all sample sizes. However, there is much more variability at the lower sample sizes. That is, with a sample size of 10, it’s not unexpected for that we would see an estimate that is off by 0.5. With larger samples, the range of bias values gets narrower, and we are less likely to see estimates that are far off from the true value.</p>
<p>We also see that small sample sizes result in large and more variable interval widths. As the sample size gets larger, the width of the 89% compatibility interval decreases and becomes more consistent (i.e., the width is very similar in each replication).</p>
<div class="sourceCode" id="cb147"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sim_results</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">replication</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span><span class="op">-</span><span class="va">sample_size</span>, names_to <span class="op">=</span> <span class="st">"measure"</span>, values_to <span class="op">=</span> <span class="st">"value"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>measure <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">measure</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"abs_error"</span>, <span class="st">"int_width"</span><span class="op">)</span>,
                          labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Absolute Error"</span>, <span class="st">"89% Interval Width"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">sample_size</span><span class="op">)</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">measure</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="http://mjskay.github.io/ggdist/reference/stat_interval.html">stat_interval</a></span><span class="op">(</span>.width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.67</span>, <span class="fl">0.89</span>, <span class="fl">0.97</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu">ramp_blue</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0.9</span>, <span class="fl">0.1</span>, length.out <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span>,
                     breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.67</span>, <span class="fl">0.89</span>, <span class="fl">0.97</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Sample Size"</span>, y <span class="op">=</span> <span class="st">"Value"</span>, color <span class="op">=</span> <span class="st">"Interval"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="03-causes-confounds-colliders_files/figure-html/w3h4-7-1.png" width="80%" style="display: block; margin: auto;"></div>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="linear-models-causal-inference.html"><span class="header-section-number">2</span> Linear Models &amp; Causal Inference</a></div>
<div class="next"><a href="references.html">References</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#causes-confounds-colliders"><span class="header-section-number">3</span> Causes, Confounds &amp; Colliders</a></li>
<li><a class="nav-link" href="#lectures-2"><span class="header-section-number">3.1</span> Lectures</a></li>
<li>
<a class="nav-link" href="#exercises-2"><span class="header-section-number">3.2</span> Exercises</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#chapter-5"><span class="header-section-number">3.2.1</span> Chapter 5</a></li>
<li><a class="nav-link" href="#chapter-6"><span class="header-section-number">3.2.2</span> Chapter 6</a></li>
</ul>
</li>
<li><a class="nav-link" href="#homework-2"><span class="header-section-number">3.3</span> Homework</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/wjakethompson/sr2-solutions/blob/main/03-causes-confounds-colliders.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/wjakethompson/sr2-solutions/edit/main/03-causes-confounds-colliders.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Statistical Rethinking: Solutions (2nd Edition)</strong>" was written by Jake Thompson. It was last built on 2022-01-30.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
